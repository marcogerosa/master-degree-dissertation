% -*- root: dissertacao.tex -*-
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setlength{\parindent}{20pt}
\setlength{\textheight}{22cm}
\setlength{\parskip}{0.2cm}
\linespread{1.2} % Para aumentar o espaçamento entre as linhas
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Fundamentação Teórica}

Para a compreensão deste trabalho é importante ter claro a definição de 3 itens, são eles: Qualidade de Código, \textit{Code Smells} e \textit{Android}.

\section{Métricas de Código}


\section{Code Smells}

Mau cheiro de código é uma indicação superficial que usualmente corresponde a um problema mais profundo em um software. Por si só um \textit{code smell}, seu termo em inglês, não é algo ruim, ocorre que frequentemente ele indica um problema mas não necessáriamente é o problema em si \cite{CodeSmell:06}. O termo em inglês \textit{code smell} foi cunhado pela primeira vez por Kent Beck enquanto ajudava Martin Fowler com o seu livro Refactoring \cite{Refactoring:99} \cite{CodeSmell:06}.

\textit{Code Smells} são padrões de código que estão associados com um design ruim e más práticas de programação. Diferentemente de erros de código eles não resultam em comportamentos erroneos. \textit{Code Smells} apontam para áreas na aplicação que podem se beneficiar de refatorações. \cite{MobileSmells:13}. Refatoração é definido por ``uma técnica para reestruturação de um código existente, alterando sua estrutura interna sem alterar seu comportamento externo'' \cite{Refactoring:99}.

Escolher não resolver \textit{code smells} pela refatoração não resultará na aplicação falhar mas irá aumentar a dificuldade de mantê-la. Logo, a refatoração ajuda a melhorar a manutenabilidade de uma aplicação \cite{MobileSmells:13}. Uma vez que os custos com manutenção são a maior parte dos custos envolvidos no ciclo de desenvolvimento de software \cite{RefactoringAndImprovements:10}, aumentar a manutenabilidade através de refatoração irá reduzir os custos de um software no longo prazo. 


\section{Android}

\subsection{Arquitetura da Plataforma}

Android é um sistema operacional de código aberto, baseado no kernel do Linux criado para um amplo conjunto de dispositivos. Para prover acesso aos recursos específicos dos dispositivos como câmera ou \textit{bluetooth}, o Android possui uma camada de abstração de \textit{hardware} (HAL do inglês \textit{Hardware Abstraction Layer}) exposto aos desenvolvedores através de um arcabouço de interfaces de programação de aplicativos (APIs do inglês \textit{Applications Programming Interface}) Java. Estes e outros elementos explicados a seguir podem ser visualizados na figura \ref{fig:AndroidPlatform} \cite{AndroidPlatformArchitecture}.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.7\textwidth]{android-architecture.png}
	\caption{Arquitetura do sistema operacional Android.}
	\label{fig:AndroidPlatform}
\end{figure}

Cada aplicativo é executado em um novo processo de sistema que contém sua própria instância do ambiente de execução Android. A partir da versão 5 (API nível 21), o ambiente de execução padrão é o Android Runtime (ART), antes desta versão era a Dalvik. ART foi escrita para executar multiplas instâncias de máquina virtual em dispositivos com pouca memória. Suas funcionalidades incluem duas forma de compilação, a frente do tempo (AOT do inglês \textit{Ahead-of-time}) e apenas no momento (JIT do inglês \textit{Just-in-time}), coletor de lixo, ferramentas de depuração, relatório de diagnósticos de erros e exceções.

Muitos do componentes e serviços básicos do Android, como ART e HAL, foram criados a partir de código nativo que depende de bibliotecas nativas escritas em C e C++. A plataforma Android provê arcabouços de APIs Java para expôr as funcionalidade de algumas destas bibliotecas nativas para os aplicativos. Por exemplo, OpenGL ES pode ser acessado através do arcabouço Android Java OpenGL API, de forma a adicionar suporte ao desenho e manipulação de gráficos 2D e 3D no aplicativo.

Todo o conjunto de funcionalidades da plataforma Android está disponível para os aplicativos através de APIs Java. Estas APIs compõem os elementos básicos para a construção de aplicativos Android. Dentre eles, os mais relevantes para esta dissertação são:

\begin{itemize}
	\item Um rico e extensível \textbf{Sistema de Visualização} para a contrução das interfaces com o usuário, também chamadas de \textit{layouts}, do aplicativo. Incluindo listas, grades, caixas de textos, botões, dentre outros.

	\item Um \textbf{Gerenciador de Recursos}, provendo acesso aos recursos ``não-java'' como textos, elementos gráficos, arquivos de \textit{layout}.

	\item Um \textbf{Gerenciador de Activity} que gerencia o ciclo de vida dos aplicativos e provê uma navegação comum.
\end{itemize}

O Android já vem com um conjunto de aplicativos básicos como por exemplo, para envio e recebimento de SMS, calendário, navegador, contatos e outros. Estes aplicativos vindos com a plataforma não possuem nenhum diferencial com relação aos aplicativos de terceiros. Todo aplicativo tem acesso ao mesmo arcabouço de APIs do Android, seja ele aplicativo da plataforma ou de terceiro. Desta forma, um aplicativo de terceiro pode se tornar o aplicativo padrão para navegar na internet, receber e enviar SMS e assim por diante.

Aplicativos da plataforma provem capacidades básicas que aplicativos de terceiros podem reutilizar. Por exemplo, se um aplicativo de terceiro quer possibilitar o envio de SMS, o mesmo pode redirecionar esta funcionalidade de forma a abrir o aplicativo de SMS já existente, ao invés de implementar por si só.

\subsection{Aplicativos Android}

Aplicativos Android são escritos na linguagem de programação Java. O Kit para Desenvolvimento de Software (SDK do inglês \textit{Software Development Kit}) Android compila o código, junto com qualquer arquivo de recursos ou dados, em um arquivo Android Package (APK). Um APK, arquivo com extensão \texttt{.apk}, é usado por dispositivos para a instalação de um aplicativo \cite{AndroidFundamentals}.

Componentes Android são os elementos base para a construção de aplicativos Android. Cada componente é um diferente ponto através do qual o sistema pode acionar o aplicativo. Nem todos os componente são pontos de entrada para o usuário e alguns são dependentes entre si, mas cada qual existe de forma autônoma e desempenha um papel específico. 

Existem quato tipos diferentes de componentes Android. Cada tipo serve um propósito distinto e tem diferentes ciclos de vida que definem como o componente é criado e destruído. O quatro componentes são:

\begin{itemize}

	\item \textbf{Activities}

	Uma \textit{activity} representa uma tela com uma interface de usuário. Por exemplo, um aplicativo de email pode ter uma \textit{activity} para mostrar a lista de emails, outra para redigir um email, outra para ler emails e assim por diante. Embora \textit{activities} trabalhem juntas de forma a criar uma experiência de usuário (UX do inglês \textit{User Experience}) coesa no aplicativo de emails, cada uma é independente da outra. Desta forma, um aplicativo diferente poderia iniciar qualquer uma destas \textit{activities} (se o aplicativo de emails permitir). Por exemplo, a \textit{activity} de redigir email no aplicativo de emails, poderia solicitar o aplicativo câmera, de forma a permitir o compartilhamento de alguma foto. Uma \textit{activity} é implementada como uma subclasse de \texttt{Activity}.  

	\item \textbf{Services}

	Um serviço é um componente que é executado em plano de fundo para processar operações de longa duração ou processar operações remotas. Um serviço não provê uma interface com o usuário. Por exemplo, um servicó pode tocar uma música em plano de fundo enquanto o usuário está usando um aplicativo diferente, ou ele pode buscar dados em um servidor remoto através da internet sem bloquear as interações do usuário com a activity. Outros componente, como uma activity, pode iniciar um serviço e deixá-lo executar em plano de fundo, durante sua execução é possível interagir com ele. Um serviço é implementado como uma subclasse de \texttt{Service}.

	\item \textbf{Content Providers}

	Um provedor de conteúdo gerencia um conjunto compartilhado de dados do aplicativo. É possível armazenar dados em arquivos de sistema, um banco de dados SQLite, num servidor remoto ou qualquer outro local de armazenamento que o aplicativo possa acessar. Através de provedores de conteúdo, outros aplicativos podem consultar ou modificar os dados (se o provedor de conteúdo permitir). Por exemplo, a plataforma Android disponibiliza um provedor de conteúdo que gerencia as informações dos contatos dos usuários. Desta forma, qualquer aplicativo, com as devidas permissões, pode consultar parte do provedor de conteúdo (como \texttt{ContactsContract.Data}) para ler e escrever informações sobre um contato específico. Um provedor de conteúdo é implementado como uma subclasse de \texttt{ContentProvider}.

	\item \textbf{Broadcast Receivers}

	Um recebedor de mensagens é um componente que responde a mensagens enviadas pelo sistema. Muitas destas mensagens são originadas da plataforma Android, por exemplo o desligamento da tela, baixo nível de bateria e assim por diante. Aplicativos de terceiros também podem enviar mensagens, por exemplo, informando que alguma operação foi concluída, com um email que concluiu seu envio. No entanto, recebedor de mensagens não possuem interface de usuário, eles podem criar notificações para alertarem o usuário que algo ocorreu. Um recebedor de mensagens é implementado como uma subclasse de \texttt{BroadcastReceiver}.

\end{itemize}

Antes de a plataforma Android poder iniciar qualquer componente do aplicativo, ela precisa saber que eles existem. Isso é feito através da leitura do arquivo \texttt{AndroidManifest.xml} do aplicativo (arquivo de manifesto). O aplicativo deve declarar todos seus componentes neste arquivo, que deve estar no diretório raiz do projeto.

O arquivo de manifesto pode conter muitas outras informações além das declarações dos componentes do projeto, por exemeplo:

\begin{itemize}
	\item Identificar qualquer permissão de usuário requerida pelo aplicativo, como acesso a internet, acesso a informações de contatos do usuário e assim por diante.

	\item Declarar o nível mínimo do Android requerido para o aplicativo, baseado em quais APIs são usadas pelo aplicativo.

	\item Declarar quais funcionalidades de sistema ou \textit{hardware} são usadas ou requeridas pelo aplicativo, por exemplo câmera, \textit{bluetooth} e assim por diante.

	\item Declarar outras APIs que são necessárias para uso do aplicativo (além do arcabouço de APIs do Android), como a biblioteca do Google Maps.
\end{itemize}

O arquivo de manifesto é um arquivo XML. Os elementos usados nele são defidos pelo Android, por exemplo, um arquivo de manifesto pode declarar uma atividade conforme a seguir. \\

\begin{lstlisting}[language=XML, caption=Arquivo \texttt{AndroidManifest.xml}]
<?xml version="1.0" encoding="utf-8"?>
<manifest ... >
    <application android:icon="@drawable/app_icon.png" ... >
        <activity android:name="com.example.project.ExampleActivity"
                  android:label="@string/example_label" ... >
        </activity>
        ...
    </application>
</manifest>	
\end{lstlisting}

No elemento \texttt{<application>} o atributo \texttt{android:icon} aponta para o ícone, que é um recurso, que identifica o aplicativo.

No elemento \texttt{<activity>}, o atributo \texttt{android:name} especifica o nome da classe completamente qualificado de uma subclasse de \texttt{Activity} e o atributo \texttt{android:label} especifica um texto para ser usado como título da atividade.

Deve-se declarar todos os componentes do aplicativo usando os seguintes elementos:
\begin{itemize}
	\item \texttt{<activity>} elemento para atividades.
	\item \texttt{<service>} elemento para serviços.
	\item \texttt{<receiver>} elemento para recebedor de mensagens.
	\item \texttt{<provider>} elemento para provedores de conteúdo.
\end{itemize}

Um aplicativo Android é composto por outros arquivos além de código Java, ele requer \emph{recursos} como imagens, arquivos de áudio, e qualquer recurso relativo a apresentação visual do aplicativo \cite{AndroidFundamentals}. Também é possível definir menus, estilos, cores e \textit{layout} das atividades.

For example, you should define animations, menus, styles, colors, and the layout of activity user interfaces with XML files. Using app resources makes it easy to update various characteristics of your app without modifying code and—by providing sets of alternative resources—enables you to optimize your app for a variety of device configurations (such as different languages and screen sizes).

