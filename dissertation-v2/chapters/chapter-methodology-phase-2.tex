\section{Etapa 2 - Importância e Frequência dos Maus Cheiros Android}
\label{etapa-2}

Para responder a QP$_2$, buscamos generalizar os maus cheiros encontrados na QP$_1$ entendendo a percepção dos desenvolvedores com relação à frequência e importância dos maus cheiros. Coletamos esta percepção por meio de um questionário online com três seções sendo a primeira para coleta de dados demográficos da mesma forma da etapa 1, a segunda para coleta da percepção de frequência dos maus cheiros no dia a dia de desenvolvimento e a terceira para coleta da percepção de importância.

Coletamos 201 respostas de desenvolvedores Android de 3 continentes e 14 países diferentes. Nossos resultados mostraram que os 20 maus cheiros são considerados, de algum modo, frequentes e importantes. A seguir, na Seção \ref{etapa-2-questionario} apresentamos detalhes sobre a concepção do questionário, na Seção \ref{etapa-2-participantes} detalhes sobre os participantes e na Seção \ref{etapa-2-analise} detalhes sobre o processo de análise dos dados. Os resultados desta etapa podem ser conferidos na Seção \ref{phase2-results}.

\subsection{Questionário}
\label{etapa-2-questionario}

Foram criadas duas versões do questionário, inglês e português, de forma que de um era possível acessar o outro, possibilitando o participante escolher o idioma mais apropriado a ele. No cabeçalho do questionário inserimos algumas informações para o participante, dentre elas, informamos que o questionário fazia parte de uma pesquisa sobre qualidade de código Android e que os dados fornecidos poderiam futuramente ser publicados de forma anônima. O questionário (S$_2$) continha 3 seções. A primeira seção, como em S$_1$, tinha o objetivo de traçar o perfil demográfico do participante (idade, estado de residência, experiência em desenvolvimento de software, experiência com desenvolvimento Android e escolaridade) e foi composta de 6 perguntas.

A segunda seção objetivou capturar a percepção dos desenvolvedores com relação à frequência em que eles percebiam os maus cheiros no seu dia a dia. Fizemos isso apresentando uma lista de afirmações onde cada afirmação descrevia um sintoma de um dos maus cheiros. Para cada afirmação o participante podia escolher uma entre cinco opções da escala \textit{likert} de frequência: muito frequente, frequente, às vezes, raramente e nunca.

As afirmações foram baseadas nas respostas de S$_1$, por exemplo, para o mau cheiro \textsc{\small Classes de UI Acopladas} algumas das respostas sobre más práticas foram \textit{``Acoplar o \textit{Fragment} a \textit{Activity} ao invés de utilizar interfaces é uma prática ruim''} (P19) e \textit{``Acoplar o \textit{Fragment} com a \textit{Activity}''} (P10, P31 e P45), e boa prática foi \textit{``Seja um componente de UI reutilizável. Então evite dependência de outros componentes da aplicação''} (P6). Com base nessas e outras respostas extraímos a seguinte frase para representar o sintoma do mau cheiro:

\begin{itemize}
 \item \textit{Fragments}, \textit{Adapters} ou \textit{Listeners} com referência direta para quem os usa, como \textit{Activities} ou outros \textit{Fragments}.
\end{itemize}

Para contemplar os 20 maus cheiros, foram apresentadas 25 afirmações sobre frequência. Essa diferença do número total de maus cheiros e o número de afirmações ocorreu pois, para 4 dos maus cheiros (\textsc{\small Comportamento Suspeito}, \textsc{\small Layout Longo ou Repetido}, \textsc{\small Longo Recurso de Estilo} e \textsc{\small Atributos de Estilo Repetidos}), foram apresentadas mais de uma afirmação, cada qual abordando um dos sintomas apresentados por ele. Optamos por separar os sintomas em afirmações para entender qual(is) sintoma(s) era(m) percebido(s) no dia a dia pelo desenvolvedor. Por exemplo, para o mau cheiro \textsc{\small Comportamento Suspeito} apresentamos três afirmações, onde cada uma representou uma forma diferente, considerada má prática pelos participantes de S$_1$, sobre como implementar a resposta a eventos do usuário no Android:

\begin{itemize}
  \item \textit{Activities}, \textit{Fragments} ou \textit{Adapters} com classes anônimas para responder a eventos do usuário, como clique, duplo clique e outros.

  \item \textit{Activities}, \textit{Fragments} ou \textit{Adapters} implementando algum \textit{Listener}, através de polimorfismo (\textit{implements}), para responder a eventos do usuário como clique, duplo clique e outros.

  \item \textit{Activities}, \textit{Fragments} ou \textit{Adapters} com classes internas implementando algum \textit{Listener} para responder a eventos do usuário como clique, duplo clique e outros.
\end{itemize}

A terceira seção objetivou capturar a percepção dos desenvolvedores com relação à importância em mitigar os sintomas dos maus cheiros, para isso foi solicitado que indicasse o quão importante ele considerava as afirmações apresentadas. Para contemplar os 20 maus cheiros, apresentamos 21 afirmações de importância que basicamente negavam as afirmações relacionadas à percepção de frequência do mau cheiro. A divergência do total de maus cheiros e o total de afirmações apresentadas se dá pelo mesmo motivo encontrado na seção anterior do questionário, sobre percepção de frequência. Para cada afirmação o participante podia escolher uma dentre as cinco opções da escala \textit{likert} de importância: muito importante, importante, razoavelmente importante, pouco importante, não é importante. A seguir apresentamos a afirmação apresentada nesta seção para o mau cheiro \textsc{\small Classes de UI Acopladas}:

\begin{itemize}
  \item \textit{Fragments}, \textit{Adapters} e \textit{Listeners} não ter referência direta à quem os utiliza.
\end{itemize}

Em nenhuma das seções indicamos que seriam apresentados sintomas de maus cheiros, nem mencionamos os nomes dos maus cheiros usados nesta dissertação, foram apresentadas somente as afirmações. Optamos por fazer desta forma para abstrair a ideia de que as frases representavam maus cheiros e portanto, não exigir do participante um conhecimento prévio sobre maus cheiros de código.

Antes da divulgação do questionário realizamos a validação de cada uma das afirmações, por meio de entrevista individual, com dois desenvolvedores Android experientes, \emph{DEV-A} e \emph{DEV-B}. \emph{DEV-A} possui 10 anos de experiência com desenvolvimento de software e 5 anos de experiência com desenvolvimento Android, se considera proficiente nas tecnologias Java, Objective C, Swift e Android e possui bacharel em Tecnologia de Informação. \emph{DEV-B} possui 7 anos de experiência com desenvolvimento de software e 6 anos de experiência com desenvolvimento Android, se considera proficiente nas tecnologias Java, Objective C e Android e possui pós-graduação em Engenharia de Software Orientada a Serviços. Ambos os desenvolvedores trabalham atualmente com desenvolvimento de aplicativos móveis em \textit{startups} brasileiras.

A entrevista de validação das afirmações foi conduzida de modo que o desenvolvedor procedia respondendo o questionário e quando tinha dúvida sobre uma frase, o mesmo questionava e então ela era discutida e quando necessário, reestruturada ou reescrita, de acordo com o comentário dado. Após a discussão, o desenvolvedor a respondia, considerando a conclusão das discussões, e seguia para a próxima. Essa dinâmica seguiu até passar por todas as afirmações e ao final o desenvolvedor era incentivado a dar qualquer outro comentário que considerasse relevante.

Alguns importantes ajustes foram realizados após a primeira entrevista de validação. O principal ajuste foi relacionado a escala \textit{likert} utilizada, sendo que, na primeira versão do questionário, respondido por \emph{DEV-A}, foi usada tanto para validar importância quanto para validar frequência a mesma escala \textit{likert} de nível de concordância (concordo totalmente, concordo, não concordo nem discordo, discordo, discordo totalmente), deixando para com a frase a responsabilidade de indicar do que se tratava, frequência ou importância. Durante a validação percebemos que as afirmações ficavam muito maiores de ler e difíceis de serem interpretadas, então trocamos para escalas de frequência e importância e ajustamos as afirmações. Também foram sugeridas melhorias em algumas poucas afirmações. Com o segundo desenvolvedor, \emph{DEV-B}, tivemos apenas dois ajustes em afirmações. Para efeitos de viés, as respostas dos desenvolvedores que participaram das entrevistas de validação foram desconsideradas.

Após a validação das afirmações, executamos um teste piloto com dois desenvolvedores, dos quais, não solicitaram alterações no questionário, considerando-o apropriado para lançamento. Essas respostas foram consideradas nas análises pois não houve necessidade de ajustes no questionário após elas ocorrerem. O questionário foi divulgado em redes sociais como Reddit, Facebook, Twitter e LinkedIn, grupos de discussão sobre Android como Android Dev Brasil\footnote{https://groups.google.com/forum/\#!forum/androidbrasil-dev}, Android Brasil Projetos\footnote{https://groups.google.com/forum/\#!forum/android-brasil--projetos} e o grupo do Slack Android Dev Br\footnote{http://slack.androiddevbr.org}, maior grupo de desenvolvedores Android do Brasil com 2622 participantes até o momento desta escrita. Para engajar os participantes ofertamos o sorteio de um Google Chromecast Áudio.

O questionário esteve aberto por aproximadamente três semanas em meados de Setembro de 2017. As afirmações eram apresentadas de forma randômica. Ao final, o questionário foi respondido por 201 desenvolvedores. A versão completa do questionário pode ser conferida no Apêndice \ref{survey2}.

\subsection{Participantes}
\label{etapa-2-participantes}

\begin{figure*}[!b]
\centering
\begin{subfigure}{.62\textwidth}
  \centering
  \includegraphics[width=.99\textwidth]{phase2-participants-graduation.png}
  \caption{Distribuição de escolaridade.}
  \label{fig:phase2-participants-graduation}
\end{subfigure}
\begin{subfigure}{.36\textwidth}
  \centering
  \includegraphics[width=.99\textwidth]{phase2-participants-age.png}
  \caption{Distribuição de idade.}
  \label{fig:phase2-participants-age}
\end{subfigure}%
\caption{Escolaridade e distribuição de idade dos participantes em S$_2$.}
\label{fig:phase2-participants-graduation-age}
\vspace{-.5cm}
\end{figure*}

Participaram desta etapa da pesquisa 201 desenvolvedores. 145 respostas vieram da versão em português do questionário e 56 da versão em inglês. Dos participantes, 15\% possuem uma ou mais pós-graduações e 61\% são graduados, esses dados podem ser observados na Figura \ref{fig:phase2-participants-graduation}. A Figura \ref{fig:phase2-participants-age} apresenta o histograma de idade dos participantes, onde podemos observar que tivemos uma abrangência considerável de idade, onde a maior parte possui de 20 a 35 anos.


Conforme apresentado na Figura \ref{fig:phase2-participants-experience}, 94\% participantes indicaram ter 2 anos ou mais de experiência com desenvolvimento de software e 74\% indicaram 2 anos ou mais de experiência com desenvolvimento Android. Esse resultado nos indica que atingimos desenvolvedores com experiência considerável em desenvolvimento de software e Android.

\begin{figure*}[!t]
\centering
\includegraphics[width=.7\linewidth]{phase2-participants-experience.png}
\caption{Tempo de experiência com desenvolvimento de software e desenvolvimento Android dos participantes de S$_2$.}
\label{fig:phase2-participants-experience}
% \vspace{-.5cm}
\end{figure*}

\begin{figure*}[!b]
  \centering
  \vspace{-.5cm}
  \includegraphics[width=.75\textwidth]{phase2-participants-languages.png}
  \caption{Nível de conhecimento em diversas linguagens de programação orientada a objetos dos participantes de S$_2$.}
  \label{fig:phase2-participants-languages}
  \vspace{-.5cm}
\end{figure*}

Perguntamos aos desenvolvedores qual seu nível de conhecimento em diversas linguagens orientadas a objetos. Na Figura \ref{fig:phase2-participants-languages} podemos observar que mais de 80\% afirmam ter conhecimento de intermediário a especialista em Java e Android. De 20\% a 58\% dos participantes afirmam ter conhecimento de intermediário a especialista em outras linguagens orientadas a objetos. 5 participantes (2\%) afirmaram não ter conhecimento sobre Android, por este motivo suas respostas foram desconsideradas da análise.

A Figura \ref{fig:phase2-participants-regions} apresenta a distribuição geográfica global e brasileira dos participantes. Nosso questionário foi respondido por profissionais de 3 continentes e 14 países diferentes porém a maior representatividade dos dados é originada do Brasil, com pouco mais de 78\% dos participantes. Os brasileiros somam 157 profissionais de 18 estados diferentes. Desse total, os estados com maior representatividade foram, na ordem: São Paulo com 57\%, Rio de Janeiro e Minhas Gerais com quase 6\% cada e Rio Grande do Sul com quase 5\%. 10\% dos participantes são originados de países Europeus. Nos Estados Unidos tivemos 2\% provenientes da Califórnia, Pensilvânia, Indiana e Utah e 0,5\% (1 participante) de Ontário no Canadá. \\

\begin{figure*}[!htb]
\centering
\vspace{-.3cm}
\begin{subfigure}{.52\textwidth}
  \centering
  \includegraphics[width=.99\textwidth]{phase-2-participants-region-mundial.png}
  \caption{Distribuição geográfica global.}
  \label{fig:phase2-participants-regions-global}
\end{subfigure}
\begin{subfigure}{.46\textwidth}
  \centering
  \includegraphics[width=1\textwidth]{phase-2-participants-region-brasil.png}
  \caption{Distribuição geográfica brasileira.}
  \label{fig:phase2-participants-regions-brasil}
\end{subfigure}%
\caption{Distribuição geográfica global e brasileira dos participantes de S$_2$.}
\label{fig:phase2-participants-regions}
% \vspace{-.5cm}
\end{figure*}

Podemos concluir que tivemos certa abrangência geográfica, porém o padrão geográfico obtido em S$_1$ se repetiu em S$_2$, e apesar de termos tido certa abrangência global, a maior representatividade é proveniente do Brasil, logo, continuamos acreditando que o mais apropriado seja dizer que a percepção de frequência e importância dos maus cheiros propostos representam a opinião de desenvolvedores brasileiros, principalmente de São Paulo.


\subsection{Análise dos Dados}
\label{etapa-2-analise}

Para análise dos dados, as opções das escalas \textit{likert} de \textbf{\small frequência} e \textbf{\small importância} foram codificadas em números de 1 a 5. Por exemplo, as opções ``Nunca'' (da escala de frequência) e ``Não é importante'' (da escala de importância) foram codificadas com 1, as opções ``Raramente'' (frequência) e ``Pouco importante'' (importância) com 2, e assim sucessivamente até as opções ``Muito frequente'' (frequência) e ``Muito importante'' (importância) que foram codificadas com~5.

De modo a avaliar a percepção dos desenvolvedores Android sobre a frequência e importância dos maus cheiros propostos, para análise dos dados extraímos de cada afirmação a mediana, moda e desvio padrão. Para os maus cheiros que apresentamos mais de uma afirmação, extraímos a média desses dados para representá-los. Por exemplo, foram apresentadas três afirmações de frequência sobre o mau cheiro \textsc{\small Comportamento Suspeito}, a moda que o representa é a média das modas de cada afirmação, que neste caso foi $(3 + 4 + 4) \div 3 = 3,7 \approx 4$.

De modo a avaliar quais maus cheiros são considerados frequentes realizamos uma simplificação da escala \textit{likert} de \textbf{\small frequência}. Classificamos de \textbf{\small frequência baixa} as resposta ``Raramente'', de \textbf{\small frequência moderada} as respostas ``Às vezes'' e por último, classificamos de \textbf{\small frequência alta} as respostas ``Frequente'' e ``Muito frequente''. Não obtivemos nenhuma afirmação com moda (MO) igual 1, ou seja, ``Nunca'', e por isso não criamos uma classificação para ela.

De modo similar, para avaliar quais maus cheiros são considerados importantes, também realizamos uma simplificação da escala \textit{likert} de \textbf{\small importância}. Classificamos de \textbf{\small importância baixa} as resposta ``Pouco importante'', de \textbf{\small importância moderada} as respostas ``Razoavelmente importante'' e classificamos de \textbf{\small importância alta} as respostas de ``Importante'' e ``Muito importante''. Também não foi necessário criar uma classificação para respostas ``Não é importante'' pois nenhuma das afirmações obteve MO igual a 1.

% As Tabelas \ref{tab:SmellFrequency} e \ref{tab:SmellImportance} apresentam respectivamente a moda e distribuição relativa de frequência e importância para cada um dos 20 maus cheiros derivados. Em vermelho são os que não atendem a condição mencionada acima e portanto, são desconsiderados para a etapa seguinte.


