\section{Etapa 3 - Percepção dos maus cheiros}
\label{etapa-3}


Para responder a QP3, buscamos validar a percepção de um subconjunto dos maus cheiros encontrados na QP1. Este subconjunto corresponde aos considerados mais frequentes e mais importantes pelos respondentes da QP2, são eles: \textsc{Componente de UI Inteligente}, \textsc{Componente de UI Acoplado}, \textsc{Componente de UI Zumbi}, \textsc{Adapter Complexo}, \textsc{Longo Recurso de Estilo}, \textsc{Comportamento Suspeito}, \textsc{Layout Profundamente Aninhado} e \textsc{Atributos de Estilo Repetidos}. 

Os dados foram coletamos por meio de um experimento de código online onde cada participante era solicitado a avaliar a qualidade de seis códigos relativos a camada de apresentação Android. Aniche et al. \cite{AnicheSmellsMVC:17, MvcSmells:16} realizou este experimento com o mesmo objetivo de validar a percepção de desenvolvedores sobre maus cheiros propostos pelos pesquisadores, no caso, específicos a aplicações Spring MVC. 

Obtivemos ao todo 66 respostas. Com os dados extraímos dados estatísticos para validar a percepção dos desenvolvedores sobre os maus cheiros avaliados. Nossos resultados mostraram que seis dos sete maus cheiros são estatisticamente percebidos por desenvolvedores Android.  A seguir, na Seção \ref{etapa-3-experimento} apresentamos detalhes sobre o experimento, na Seção \ref{etapa-3-participantes} detalhes sobre os participantes e na Seção \ref{etapa-3-analise} detalhes sobre o processo de análise dos dados. Os resultados desta etapa podem ser conferidos na Seção \ref{phase3-results}.

\subsection{Experimento}
\label{etapa-3-experimento}

O experimento conteve duas seções principais. A primeira seção teve como objetivo coletar informações demográficas, principalmente com relação a experiência dos participantes. Na segunda seção os participantes foram solicitados a analisar seis códigos e, para cada um deles, responder as seguintes perguntas:

\noindent
\begin{itemize}
  \item[P1] Na sua opinião, este código apresenta algum problema de design e/ou implementação? Respostas possíveis: SIM/NÃO
  \item[P2] Se SIM, por favor explique quais são, na sua opinião, os problemas que afetam este código. Pergunta aberta.
  \item[P3] Se SIM, por favor avalie a severidade do problema de design e/ou implementação selecionando dentre as opções a seguir. Respostas possíveis sendo uma escala \textit{Likert} de 5 pontos de 1 (muito baixa) até 5 (muito alta).
\end{itemize}

Os códigos apresentados foram randomicamente selecionados de um conjunto de 51 códigos. Desse conjunto, 35 códigos são \textit{``mau cheirosos''}, ou seja, afetados por um dos sete maus cheiros avaliados (cinco códigos para cada mau cheiro) e 16 códigos são \textit{``limpos''}, ou seja, não afetado por maus cheiros. É importante salientar que, para reduzirmos possíveis bias, nos dois grupos de códigos, selecionamos apenas \textit{Activities}, \textit{Fragments}, \textit{Adapters}, \textit{Listeners}, recursos de \textit{Layout}, \textit{String} e \textit{Style}, uma vez que são esses os tipos de códigos da camada de apresentação Android, cujo os maus cheiros propostos e avaliados se focam.

Os projetos foram aleatoriamente selecionados da base de softwares livres Android, F-Droid\footnote{f-droid.org é um repositório que lista projetos gratuitos e software livre Android (FOOS, do inglês \textit{Free and Open Source Software}).}. A Tabela \ref{tab:android-projects} lista os projetos usados, bem como informações como avaliação (estrelas), total de instalações e versão atual do aplicativo na Google Play Store, loja oficial de aplicativos Android, para os aplicativos que lá estão disponíveis. 

\begin{table}[h]
\centering
\renewcommand*{\arraystretch}{1}
\footnotesize 
\begin{tabular}{@{}p{9cm}lll@{}}
\toprule
\multirow{2}{*}{\textbf{Código-Fonte}} & \multicolumn{3}{c}{\textbf{Google Play Store}} \\ \cmidrule{2-4}
                                       & \textbf{Estrelas}    & \textbf{Instalações}    & \textbf{Versão} \\
\bottomrule
https://github.com/uberspot/2048-android & 4.2 &  1.000.000 - 5.000.000 & 2.08 \\
https://github.com/jereksel/Bucket & 4.2 &  1.000 - 5.000 & 0.2.1-play \\
https://github.com/TeamAmaze/AmazeFileManager & 4.3 &  500.000 - 1.000.000 & 3.2.1 \\
https://gitlab.com/cfabio/AltcoinPrices &  &   &  \\
https://github.com/pinetum/AirUnlock-for-Android &  &   &  \\
https://github.com/SecUSo/privacy-friendly-weather & 3.8 &  1.000 - 5.000 & 1.1 \\
https://github.com/Xlythe/Calculator &  &   &  \\
https://github.com/mkulesh/microMathematics & 4.7 &  500 - 1.000 & 2.15.6 \\
https://github.com/openfoodfacts/openfoodfacts-androidapp & 4.0 &  1.000 - 5.000 & 0.7.4 \\
\bottomrule
\end{tabular}
\caption{Lista dos nove projetos de software livre Android usados para coletar os códigos usados no experimento.}
\label{tab:android-projects}
\end{table}


Para reduzir efeitos de aprendizagem e viés de ordem, cada participante recebeu os seis códigos randomicamente selecionados em ordem aleatória. Além disso, os participantes não foram informados de quais códigos pertenciam a quais grupos (maus cheirosos ou limpos). Os participantes foram informados apenas de que a pesquisa tinha como objetivo estudar a qualidade de códigos da camada de apresentação de aplicativos Android nativos. Não foi imposto nenhum limite de tempo para completar a tarefa.

Para comparar as distribuições de severidade indicada pelos respondentes para os dois grupos de códigos, utilizamos o teste não pareado de Mann-Whitney \cite{Conover:99}. Este teste é usado para analisar a significância estatística das diferenças entre a severidade atribuída pelos respondentes aos problemas que eles observam nos códigos mau cheirosos e limpos. Os resultados são considerados estatisticamente significativos em $\alpha \leq$  0,05. Também estimamos a magnitude das diferenças medidas usando o Cliff's Delta (ou \textit{d}), uma medida de tamanho de efeito não paramétrico \cite{EffectSize:05} para dados ordinais. Seguimos diretrizes bem estabelecidas para interpretar os valores do tamanho do efeito, sendo: desprezível para | \textit{d} | < 0,14, pequeno para 0,14 $\leq$ | \textit{d} | < 0,33, médio para 0,33 $\leq$ | \textit{d} | < 0.474, e grande para | \textit{d} | $\geq$ 0,474 \cite{EffectSize:05}. Finalmente, relatamos resultados qualitativos derivados das respostas abertas dos participantes.



% 1. mencionar quais são os projetos e como os códigos foram manualmente selecionados
% 2. falar que os códigos fontes são
% 3. Justificativa do limite de smells validados. Poderíamos aumentar os smells conforme fossemos conseguindo a quantidade de respostas necessárias. (file:///Users/suelengc/Downloads/Pesquisa%20Survey%2001-2.pdf) Fink (1995) o tamanho da amostra se refere ao número de respondentes necessário para que os resultados obtidos sejam precisos e confiáveis, e que o aumento no tamanho da amostra diminui o erro. Fala tb sobre o número 30 observações. (https://www.mendeley.com/viewer/?fileId=0eaba507-ab72-66c7-7354-79aa49780aad&documentId=a744673b-5f59-397e-b37f-ad47d650bc51)






% Para responder a QP3 realizamos um experimento de código com o objetivo de validar a percepção de desenvolvedores Android sobre os maus cheiros propostos. Elaboramos o experimento de modo que fosse possível validar os maus cheiros mais importantes e mais frequentes do ponto de vista dos respondentes em QP2 e que fosse viável. Deste modo, selecionamos sete maus cheiros considerados mais importantes e frequentes pelos respondentes da QP2 para serem validados.

% Nesse experimento, cada desenvolvedor avaliou seis códigos dos quais, três deles são afetados por um dos 8 maus cheiros e os outros três são códigos limpos, ou seja, não afetado por nenhum mau cheiro. Os códigos foram apresentados de forma randômica e para cada código o desenvolvedor respondia três questões sobre a percepção de algum problema, qual seria o problema e a severidade. O experimento foi disponibilizado online por meio de um questionário desenvolvido especificamente para esta pesquisa, cujo o projeto é de código aberto\footnote{https://github.com/SuelenGC/code-experiment-survey-app}. 

% Este experimento equivale ao experimento realizado por Aniche et al. \cite{AnicheSmellsMVC:17, MvcSmells:16} com o mesmo objetivo de validar a percepção de código sobre seis maus cheiros propostos pelos pesquisadores específicos a aplicações Spring MVC. 


% \subsection{Experimento}

% De forma a obtermos pontos de dados o suficiente para a análise estatística dos maus cheiros devido ao número limitado de participantes no experimento, avaliamos um subconjunto contendo os 8 principais maus cheiros dentre os 21 propostos. Esses foram selecionados a partir do seguinte critério: todos os que apresentaram MO de importância e frequência 3, 4 ou 5 e DP inferior a 1,20. Ou seja, se um mau cheiro apresenta MO de importância 3, 4 ou 5 mas MO de frequência inferior a 3, mesmo que o DP seja inferior a 1,20 ainda assim ele não foi selecionado para participar do experimento. 

% A Tabela \ref{tab:SelectedSmellFrequencyImportance} apresenta os maus cheiros avaliados no experimento. Podemos observar que cinco deles são maus cheiros em componentes da camada de apresentação Android (\textsc{\small Componente de UI Inteligente}, \textsc{\small Componente de UI Acoplado}, \textsc{\small Componente de UI Zumbi}, \textsc{\small Adapter Complexo} e \textsc{\small Comportamento Suspeito}) e três são maus cheiros relacionados a recursos Android (\textsc{\small Longo Recurso de Estilo}, \textsc{\small Layout Profundamente Aninhado} e \textsc{\small Atributos de Estilo Repetidos}).


% \begin{table}[!htb]
% \centering
% \renewcommand*{\arraystretch}{1}
% \footnotesize 
% \caption{Maus cheiros selecionados para o experimento com MO de importância e frequência igual a 3, 4 ou 5 e DP menor que 1,20.}
% \begin{tabular}{@{}p{9cm}cccp{.5cm}ccc@{}}
% \toprule
%  \multirow{2}{*}{\textbf{Mau Cheiro}} & \multicolumn{3}{c}{\textbf{Importância}} & & \multicolumn{3}{c}{\textbf{Frequência}} \\ \cmidrule{2-4} \cmidrule{6-8}
%                                       & \textbf{ME} & \textbf{MO} & \textbf{DP} & & \textbf{ME} & \textbf{MO} & \textbf{DP} \\
% \bottomrule
% \textsc{Componente de UI Inteligente} & 5 & 5 & 1,05 & & 3 & 4 & 1,19 \\ 
% \textsc{Componente de UI Acoplado} & 4 & 5 & 1,02 & & 3 & 3 & 1,15 \\ 
% \textsc{Componente de UI Zumbi} & 5 & 5 & 0,88 & & 3 & 3 & 1,16 \\ 
% \textsc{Adapter Complexo} & 4 & 5 & 0,91 & & 3 & 3 & 1,15 \\ 
% \textsc{Longo Recurso de Estilo} & 4 & 4 & 1,06 & & 4 & 5 & 1,18 \\ 
% \textsc{Comportamento Suspeito} & 3 & 4 & 1,19 & & 3 & 4 & 1,19 \\ 
% \textsc{Layout Profundamente Aninhado} & 4 & 4 & 1,12 & & 4 & 4 & 1,06 \\ 
% \textsc{Atributos de Estilo Repetidos} & 4 & 4 & 0,86 & & 4 & 4 & 1,11 \\ 
% \toprule
% \multicolumn{8}{@{}l@{}}{DP = Desvio Padrão, MO = Moda, ME = Média.} \\
% \bottomrule
% \end{tabular}
% \label{tab:SelectedSmellFrequencyImportance}
% \end{table}

% Os dados foram coletamos por meio de um questionário online composto por duas seções. A primeira teve o objetivo de coletar dados demográficos como experiência, total de aplicativos publicados e ocupação atual. A segunda seção apresentava seis códigos, três afetados por um dos oito maus cheiros e três limpos. Esses códigos eram selecionados randomicamente de duas listas de códigos pré-selecionados, uma lista de códigos ``maus cheirosos'' e outra de códigos ``limpos'', de modo que nunca eram apresentados códigos repetidos para um mesmo participante. Como nossa necessidade de questionário online era bem peculiar, não encontramos nenhuma ferramenta que nos atendesse plenamente e portanto desenvolvemos nossa própria ferramenta de questionário para a realização do experimento. Esta ferramenta é de código aberto e está disponível no GitHub.

% Os códigos das listas ``maus cheirosos'' e ``limpos'' foram selecionados manualmente de projetos de código aberto disponíveis no GitHub. Esses códigos foram ligeiramente modificados para não desfocar o participante do objetivo do experimento. Foram selecionados cinco códigos para cada um dos 8 maus cheiros avaliados, totalizando 40 códigos. Também foram selecionados cinco códigos limpos, ou seja, que não apresentavam nenhum mau cheiro, para cada mau cheiro avaliado, totalizando também 40 códigos limpos. Ou seja, se um dos maus cheiros afeta \textit{Activities}, então foram selecionados cinco códigos de \textit{Activities} que apresentassem o mau cheiro e cinco código de \textit{Activities} limpas. Por fim, para o experimento foram selecionados um total de 80 códigos, sendo 40 ``maus cheirosos'' e 40 ``limpos''. Para cada código selecionado foi criado um \textit{gist}, link para o código específico, também na plataforma do GitHub. A lista contendo todos os \textit{gists} dos códigos usados no experimento, segmentado por maus cheiro, pode ser consultada no Apêndice \ref{experiment-gists}.

% Todo código selecionado foi ligeiramente modificado de modo a apresentar apenas o mau cheiro que se buscava avaliar ou de modo a representar um código limpo. Os códigos limpos também foram ligeiramente modificados de modo a remover qualquer código que pudesse indicar a presença de algum mau cheiro ou desfocar o participante. As modificações realizadas tiveram o único objetivo de focar as atenções dos participantes do experimento em avaliar os maus cheiros propostos. Um exemplo de modificação é a total remoção de declarações \textit{packages} e \textit{imports}. Para cada código apresentado, o participante era solicitado a responder três questões, listadas a seguir:

% \begin{itemize}
%   \item Na sua opinião, este código apresenta algum problema de design e/ou implementação? (Sim/Não)
%   \item Se SIM, por favor explique quais são, na sua opinião, os problemas que afetam este código. (Pergunta aberta)
%   \item Se SIM, por favor avalie a severidade do problema de design e/ou implementação selecionando dentre as opções a seguir: (Escala \textit{likert}: Muito baixa, Baixa, Média, Alta, Muito alta)
% \end{itemize}

% Com o objetivo de mitigar viés ou enganos na seleção manual de códigos que representassem os maus cheiros, realizamos a validação dos códigos com outros dois desenvolvedores Android experientes. \todo{qndo tiver info sobre o feedback colocar aqui}.

\subsection{Participantes}
\label{etapa-3-participantes}

% Todos os participantes exceto 1, são atualmente desenvolvedores Android profissionais, ou seja, atuam profissionalmente com a plataforma Android. 70\% responderam com seu email para receber resultados da pesquisa, tal como em \textit{S1}, pode ser um indicativo de interesse legítimo da comunidade sobre esta temática. Questionamos da experiência com desenvolvimento de software, bem como com desenvolvimento Android, notamos que 55\% relataram ter mais de 5 aplicativos publicados e 47\% tinham mais de 4 anos de experiência com Android. A experiência dos desenvolvedores pode ser visualizada na Figura \ref{fig:ExpDevsS2}.





\subsection{Análise dos Dados}
\label{etapa-3-analise}
\todo{Aguardando resultado para análise. }

% Nossa análise consistiu em investigar a percepção dos desenvolvedores sobre códigos limpos, códigos afetados pelas más práticas e códigos afetados por maus cheiros tradicionais, exemplo, Classe Deus/Longa ou Método Longo. Dividimos a análise da percepção em dois grupos: más práticas que afetam apenas códigos Java, no caso apenas a LCUI, e más práticas que afetam apenas recursos da aplicação, no caso LPA, NRD e RM.

% Para o grupo de más práticas que afetam código Java, analisamos a percepção dos desenvolvedores a partir de três comparações: classes afetadas pela má prática vs. classes limpas, classes afetadas pela má prática vs. classes afetadas por maus cheiros tradicionais e por fim, classes afetadas por maus cheiros tradicionais vs. classes limpas. Para o grupo de más práticas que afetam apenas recursos da aplicação, analisamos a percepção dos desenvolvedores a partir da comparação entre códigos afetados pela má prática vs. códigos limpos.

% não tenho certeza se deveria estar <= a 0,05 ou como estava, = 0,05
% Para comparar as distribuições da severidade indicada pelos participantes, utilizamos o teste de Mann-Whitney não pareado \cite{Conover1999} para analisar a significância estatística das diferenças entre a severidade atribuída pelos participantes aos problemas que observam em códigos Android cheirosos e códigos limpos. Os resultados são considerados estatisticamente significativos em $\alpha$ $\leq{=}$ 0,05. Também estimamos a magnitude das diferenças medidas usando o Delta de Cliff (ou d), uma medida de tamanho do efeito não paramétrico \cite{GrissomKim2005} para dados ordinais. Seguimos diretrizes bem estabelecidas para interpretar os valores do tamanho do efeito: insignificante para | d | $<$ 0,14, baixo para 0,14 $\leq$ | d | $<$ 0,33, médio para 0,33 $\leq$ | d | $<$ 0,474, e alto para | d | $\geq$ 0,474 [49]. Finalmente, relatamos achados qualitativos derivados das respostas abertas dos participantes.


% \section{Processo de Escrita dos Maus Cheiros}

% Em construção.

% \subsection{Classificação dos Maus Cheiros}

