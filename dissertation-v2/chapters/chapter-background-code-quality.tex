% -*- root: index.tex -*-
\section{Maus Cheiros de Código}

É comum no dia a dia de desenvolvimento de software ouvirmos o termo \textit{boas práticas} como uma generalização para se referir a termos como padrões de projetos, anti-padrões, \emph{maus cheiros de código} e outros, que encapsulam ideias sobre como criar códigos com \emph{mais qualidade}. 

As primeiras definições em torno de \emph{qualidade de software} são derivadas ou extraídas do modelo ISO 9126-3, atualmente ISO 25010:2011, também conhecido como SQuaRE [2]. Este modelo subdivide qualidade de software em 6 áreas: funcionalidade, confiabilidade, usabilidade, eficiência, manutenabilidade e portabilidade. Dentre estas áreas, manutenabilidade engloba conceitos como \emph{legibilidade}, quão fácil é para nós localizar os elementos que queremos melhorar ou corrigir; \emph{alterabilidade}, quanto trabalho precisamos fazer para implementar uma modificação; \emph{estabilidade}, quão poucas coisas quebram após nossas mudanças; e \emph{testabilidade}, nossa capacidade de validar nossas modificações \cite{CodeQuality:06}. 

Apesar dessa comum generalização, cada um desses termos possui um significado distinto que os diferenciam entre si. Para melhor entendimento sobre o contexto desta pesquisa, nesta seção apresentamos a definição dos principais termos que se confundem: boas práticas, padrões de projeto, anti-padrões e maus cheiros de código. Ao final, concluímos com uma reflexão das semelhanças e diferenças entre eles.

% \subsection{Métricas}
\subsection{Boas Práticas}

  Segundo o dicionário Aurélio \cite{AurelioPratica}, \textit{prática} significa ``maneira habitual de proceder''. O termo não é restrito a uma área do conhecimento, e a depender da área em que é usado, englobará um conjunto diferente de maneiras habituais. 

  Em desenvolvimento de software, boas práticas de código são um conjunto de regras que a comunidade de desenvolvimento de software aprendeu ao longo do tempo, e que pode ajudar a melhorar a qualidade do software \cite{CodeComplete:04}. Dentre este conjunto de regras temos padrões de projetos e maus cheiros de códigos.

\subsection{Padrões de Projeto}

  
  \epigraph{\emph{\textbf{Padrão:} Algo que serve como modelo. Um exemplo para os outros seguirem.}}{--- \textup{Dicionário Oxford [2]}}

  Não podemos falar sobre \emph{padrões de projetos} sem antes falarmos sobre \emph{padrões}. Segundo o dicionário Oxford um padrão é \emph{algo que serve como modelo, um exemplo para os outros seguirem} [2]. Padrões não são invenção de algo novo, é uma forma de organizar o conhecimento de experiências [1].

  Em engenharia de software, a principal definição sobre \emph{padrões} foi cunhada no livro Uma Linguagem de Padrões do arquiteto Christopher Alexander (1977) [50] onde ele define um \emph{padrão} como sendo uma regra de \emph{três partes} que expressa a \emph{relação} entre um certo \textbf{contexto}, um \textbf{problema} e uma \textbf{solução}. Martin Fowler apresenta uma definição mais simples que diz que \emph{um padrão é uma ideia que foi útil em algum contexto prático e provavelmente será útil em outros} [9]. 

  % A seguir, apresentamos a citação original completa:

  % \begin{quote}
  %   Cada padrão descreve um \emph{problema} no nosso \emph{ambiente} e o cerne de sua \emph{solução}, de tal forma que você possa usar essa solução mais de um milhão de vezes, sem nunca fazê-lo da mesma maneira. --- Christopher Alexander, Uma Linguagem de Padrões [50]
  % \end{quote}

  Inspirados por Alexander [50], Kent Beck e Ward Cunnigham fizeram alguns experimentos do uso de padrões na área de desenvolvimento de software e apresentaram estes resultados na OOPSLA em 1987. E, apoiando-se na definição de padrões de Alexander, Design Pattern - GoF (1994) foi o primeiro livro sobre padrões de software a ser lançado. Documentando X padrões. 

  Logo, temos que padrões são modelos a serem seguidos visto que já...

  % Em seguida, Padrões de Software: Contos da Comunidade de Software (1996) 


\subsection{Anti-Padrões}

  Um anti-padrão é uma resposta comum a um problema recorrente que geralmente é ineficaz e corre o risco de ser altamente contraproducente. O termo foi cunhado por Andrew Koenig em um artigo publicado em 1995, inspirado pelo livro GoF. 

  O termo se popularizou 3 anos após, em 1998 com o livro Antipatterns. Uma importante informação que este livro agrega é como diferenciar um anti-padrão de um mal hábito, má prática ou ideia ruim. Para isso o livro cita que um anti-padrão deve apresentar dois elementos: 1) um processo, estrutura ou padrão de ação comumente usado que, apesar de inicialmente parecer ser uma resposta adequada e efetiva a um problema, tem mais consequências ruins do que as boas, 2) existe outra solução que é documentada, repetitiva e provada ser eficaz.


\subsection{Maus Cheiros de Código}

  \epigraph{``Se cheirar mau, troque-o."}{--- \textup{Citação da avó Beck no Livro Refactoring \cite{Webster:95}}}

  Podemos entender um mau cheiro de código como uma percepção empírica de que algo não está certo no software, percepção semelhante o dito popular ``Algo não cheira bem!'' quando uma pessoa está desconfiada de que há um problema em dada situação.

  Um dos primeiros livro a usar o \emph{conceito} de mau cheiro de código foi o livro de Webster (1995) \cite{Webster:95} através do termo \emph{``armadilha''}. No livro são apresentadas 82 \emph{armadilhas} no Desenvolvimento Orientado a Objetos originadas da experiência do autor. Longos métodos e complexidade excessiva por exemplo são definidos na \emph{armadilha} \textit{Letting objects Become Bloated} \cite[p.~180]{Webster:95}. 

  Apesar do conceito já permear em livros e publicações sobre desenvolvimento de software desde o começo da década de 90, o termo só se popularizou após o livro \textit{Refatoração: Aperfeiçoando o Projeto de Código Existente} (Fowler, M 1999) \cite{Refactoring:99}. Refatoração, segundo Fowler, é o ato de \emph{alterarmos o código sem alterar seu comportamento} com o objetivo de torná-lo mais fácil de ser entendido e menos custoso de ser modificado. No livro são apresentadas diversas técnicas de  refatoração. O termo mau cheiro de código é usado para explicar ao leitor o \emph{``quando''} uma refatoração deve ser aplicada. Segundo o livro, \textbf{\emph{``mau cheiro de código são indicações de que existe um problema que pode ser resolvido por meio de uma refatoração''}}. Essas indicações provém do conhecimento empírico de desenvolvedores experientes, que ao longo dos anos, após trabalharem em diversos códigos bons e ruins, são capazes de listar características que podem indicar se um trecho de código é problemático. 

  Em uma postagem em seu site oficial em 2006 \cite{CodeSmell:06}, Fowler afrouxou um pouco mais a definição do termo dizendo que \emph{``mau cheiro de código são indicações superficiais que geralmente corresponde a um problema mais profundo no sistema''}.

  No livro são apresentados 22 maus cheiros e mais de 70 técnicas de refatoração. \textit{Código Duplicado} \cite[p.~63]{Refactoring:99} é um exemplo de mau cheiro que trata de problemas comuns que podem resultar na duplicação de código, por exemplo, ter a mesma expressão em dois métodos da mesma classe ou em duas subclasses irmãs. Para resolver este mau cheiro é indicada a refatoração \textit{Extrair Método} \cite[p.~89]{Refactoring:99}, ou seja, extrair a expressão duplicada para um novo método e substituí-lo nos lugares onde a expressão era usada. 

  Nos anos seguintes o termo mau cheiro se tornou frequente em livros \cite{CleanCode:08, Refactoring:14} e pesquisas acadêmicas. No livro \textit{Clean Code} (Martin, R 2008) \cite{CleanCode:08}, que se tornou muito popular entre desenvolvedores de software, são definidos novos maus cheiros além de citar alguns já apresentados por Fowler \cite{Refactoring:99}. Ele se apoia na definição de Fowler para explicar o conceito de mau cheiro.


% \subsection{Definindo Novos Maus Cheiros}

%   Tão importante quanto saber o que é um mau cheiro é entender como identificá-lo, validá-lo e documentá-lo. Nas últimas 3 décadas este tema veem despertando a curiosidade de diversos pesquisadores ao redor do mundo.

%   É possível perceber que a identificação parte de coleta de dados empíricos, por meio de questionários e entrevistas.  

\subsubsection{Formato dos Maus Cheiros}

  Os primeiros maus cheiros definidos vieram em formato textual e diferentemente de padrões, não parece existir guias de como documentar um mau cheiro. 

  Fowler \cite{Refactoring:99} por exemplo, se utiliza de \textit{título} e um \textit{texto explicativo}. No \textit{texto explicativo}, é possível encontrarmos informações sobre contexto, exemplos de problemas comuns e possíveis refatorações, dentre as listadas no livro, que resolveriam o mau cheiro. A seguir, temos o mau cheiro \textit{Código Duplicado} \cite[p.~71]{Refactoring:99}. O \textit{título} do mau cheiro indica o contexto por ele tratado. No parágrafo (1) podemos observar uma breve resumo do que faz cheirar mal e uma possível refatoração. Nos parágrafos seguintes (2-4) são apresentadas em mais detalhes situações comuns que podem indicar a presença do mau cheiro. \\

  \begin{square}
    \small
    \textbf{Código Duplicado}

    O número um no \textit{ranking} dos cheiros é o código duplicado. Se você vir o mesmo código em mais de um lugar, pode ter certeza de que seu programa será melhor se você encontrar uma maneira de unificá-los (1). 

    O problema mais simples de código duplicado é quando você tem a mesma expressão em dois métodos da mesma classe. Tudo o que você tem que fazer então é utilizar o \textit{Extrair Método} e chamar o código de ambos os lugares (2). 

    Outro problema de duplicação comum é quando você tem a mesma expressão em duas subclasses irmãs. Você pode eliminar essa duplicação usando \textit{Extrair Método} em ambas as classes e então \textit{Subir Método na Hierarquia}. Se o código for similar mas não o mesmo, você precisa usar \textit{Extrair Método} para separar as partes semelhantes daquelas diferentes. Você pode então descobrir que pode usar \textit{Criar um Método Padrão}. Se os métodos fazem a mesma coisa com um algoritmo diferente, você pode escolher o mais claro deles e usar \textit{Substituir o Algoritmo} (3).

    Se você tem código duplicado em duas classes não relacionadas, considere usar \textit{Extrair Classe} em uma classe e então usar o novo componente na outra. Uma outra possibilidade é de que o método realmente pertença a apenas uma das classes e deva ser chamado pela outra ou que o método pertença a uma terceira classe que deva ser referida por ambas as classes originais. Você tem que decidir onde o método faz mais sentido e garantir que ele esteja lá e em mais nenhum lugar (4).
  \end{square}


  Martin \cite{CleanCode:08} usa a mesma estrutura usada por Fowler e adiciona a ela uma \textit{sigla}. O \textit{texto explicativo} é apresentado em parágrafo único e é possível encontrar contexto, alguns exemplos de problemas comuns e exemplos de código, sendo que alguns maus cheiros apresentam todas essas informações ou apenas uma combinação delas. O \textit{título} usado por Martin aponta de certa forma o problema (o uso de convenção durante o desenvolvimento) e a solução (sempre que possível, preferir o uso de estruturas acima da convenção). 

  A seguir temos o mau cheiro \textit{G27: Estrutura acima de convenção} \cite[p.~301]{CleanCode:08}. No \textit{texto explicativo} em parágrafo único, podemos observar em orações a mesma estrutura que vimos no mau cheiro anterior, porém em parágrafos. Na oração (1) temos algo relacionado ao que faz cheirar mal, na oração (2) uma possível refatoração, na (3) é dado um exemplo e na (4) é indicado o problema resultante de se basear em convenção. \\

  \begin{square}
    \small
    \textbf{G27: Estrutura acima de convenção}

    Insista para que as decisões do projeto baseiem-se em estrutura acima de convenção (1). Convenções de nomenclaturas são boas, mas são inferiores a estruturas, que forçam um certo cumprimento (2). Por exemplo, \texttt{switch/case} com enumerações bem nomeadas são inferiores a classes base com métodos abstratos (3). Ninguém é obrigado a implementar a estrutura \texttt{switch/case} da mesma forma o tempo todo; mas as classes bases obrigam a implementação de todos os métodos abstratos das classes concretas (4).
  \end{square}

  Em pesquisas que definem novos maus cheiros, observamos um formato similar aos mencionados porém, adicionado uma estratégia de detecção, com foco em automatizar a identificação do mau cheiro \cite{MvcSmells:16, CSSCodeSmell}. Estas estratégias comumente se baseiam em métricas de software já existentes, como as mencionadas na sessão Métricas X.X.



\subsection{Boas Práticas vs Padrões/Anti-Padrões vs Maus Cheiros de Código}

Para entender melhor o que seria um mau cheiro e sua relação com padrões, antipadrões e práticas, pense no seguinte cenário: você na rua observa um homem correndo com uma bolsa feminina e uma mulher correndo atrás dele. Este cenário facilmente pode se encaixar num contexto de um homem que rouba a bolsa de uma mulher, e por padrão, ao vermos uma situação como esta, provavelmente devemos chamar a polícia. Mas este mesmo cenário pode representar um casal com pressa de pegar um ônibus ou táxi por exemplo, e neste contexto, não precisamos fazer nada.

Podemos pensar que o cenário que descrevemos representa um mau cheiro de forma que, ele não é um problema, mas pode apontar para problemas mais profundos ou não, mas que certamente vale uma análise para chegar a essas conclusões. Veja que, se for identificado que é um roubo, podemos então aplicar um padrão: ``chamar a polícia''. Logo, um mau cheiro pode representar um \textbf{contexto} de um padrão (ou anti-padrão), sendo assim, pode ser que a aplicação do padrão o resolva. Entretanto, pode ser que não exista ainda nenhum padrão para resolver o mau cheiro, então uma solução terá de ser criada.

Podemos dizer então que um padrão é a documentação formal de boas práticas.

% BIO
% =================================================================

% PRATICAS
% [1] https://dicionariodoaurelio.com/pratica
% [2] https://en.wikipedia.org/wiki/Best_practice #Critique
% [3] http://www.farrell-associates.com.au/Papers/Best%20Practice.pdf


% PADROES
% [1] mono ita 
% [2] https://en.oxforddictionaries.com/definition/pattern
% [9] FOWLER, M. Analysis Patterns: Reusable Object Models. Addison-Wesley Professional, 1996. 

% ANTI-PADROES
% [1]  Koenig, Andrew (March–April 1995). "Patterns and Antipatterns". Journal of Object-Oriented Programming. 8 (1): 46–48.; was later re-printed in the: Rising, Linda (1998). The patterns handbook: techniques, strategies, and applications. Cambridge, U.K.: Cambridge University Press. p. 387. ISBN 0-521-64818-1. "An antipattern is just like a pattern, except that instead of a solution it gives something that looks superficially like a solution, but isn't one."
% Buscar mais aqui https://en.wikipedia.org/wiki/Anti-pattern#Software_engineering




% QUALIDADE DE CÓDIGO
% [1] https://en.wikipedia.org/wiki/Software_quality#cite_note-34
% [2] https://www.iso.org/standard/35733.html