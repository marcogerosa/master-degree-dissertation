% -*- root: index.tex -*-
\section{Qualidade de Código}

É comum no dia-a-dia de desenvolvimento de software ouvirmos o termos \textit{boas práticas} como uma generalização para se referir a \textit{padrões de projetos}, \textit{anti-padrões} e \textit{maus cheiros de código}. Apesar dessa comum generalização, cada um destes termos possuem significados levemente distintos que os diferenciam entre si. \\

Dessa forma, esta sessão tem como objetivo fundamentar e definir esses termos, para efeitos deste trabalho, objetivando tornar mais claro o entendimento da pesquisa.

\subsection{Métricas}

\subsection{Boas Práticas}

Segundo o dicionário Aurélio [1], \textit{prática} significa ``maneira habitual de proceder''. Dessa forma, podemos dizer que \textit{boas práticas} é ``um conjunto de maneiras habituais de proceder consideradas boas, e portanto recomendadas, sobre uma determinada área''.

Uma \textit{melhor prática} é segundo [2], ``um método ou técnica geralmente aceito como superior a qualquer outra alternativa porque produz resultados superiores'' ou ``uma forma de se fazer algo que foi aceita como padrão''. \\

A leve diferença entre um termo e outro tem sido discutida em diversos trabalhos [2, 3] mas não altera seu significado. Para efeitos deste texto, usaremos o termo \textbf{boas práticas} para representar o \textbf{conjunto de práticas consideradas boas, e portanto recomendadas, por desenvolvedores no desenvolvimento de aplicativos Android}.



\subsection{Padrões e Padrões de Projeto}

Padrões não são invenção de algo novo, é uma forma de organizar o conhecimento de experiências [1]. O arquiteto Christopher Alexander definiu XXX padrões sobre arquitetura civil em seu Livro Pattern Language publicado em 1977. Christopher define padrão como sendo uma regra de três partes que expressa a relação entre um certo \textbf{contexto}, um \textbf{problema} e uma \textbf{solução} [50]. 

Martin Fowler apresenta uma definição mais simples que diz que: um padrão é uma ideia que foi útil em algum contexto prático e provavelmente será útil em outros [9]. Podemos dizer então que um padrão é a documentação formal de práticas boas práticas.

Inspirados por Christopher, Kent Beck e Ward Cunnigham começaram a fazer alguns experimentos do uso de padrões na área de desenvolvimento de software e apresentaram estes resultados na OOPSLA em 1987. 

Em 1994, Design Pattern - GoF, o primeiro livro sobre padrões de software foi lançado. Documentando X padrões. No livro, um padrão de projeto é definido como ``''



\subsection{Anti-Padrões}

Um anti-padrão é uma resposta comum a um problema recorrente que geralmente é ineficaz e corre o risco de ser altamente contraproducente. O termo foi cunhado por Andrew Koenig em um artigo publicado em 1995, inspirado pelo livro GoF. 

O termo se popularizou 3 anos após, em 1998 com o livro Antipatterns. Uma importante informação que este livro agrega é como diferenciar um anti-padrão de um mal hábito, má prática ou ideia ruim. Para isso o livro cita que um anti-padrão deve apresentar dois elementos: 1) um processo, estrutura ou padrão de ação comumente usado que, apesar de inicialmente parecer ser uma resposta adequada e efetiva a um problema, tem mais consequências ruins do que as boas, 2) existe outra solução que é documentada, repetitiva e provada ser eficaz.


\section{Maus Cheiros de Código}

\epigraph{``Se cheira mau, troque."}{--- \textup{Citação a avó Beck no Livro Refactoring \cite{Webster:95}}}

Há quem acredite que o livro de Webster (1995) \cite{Webster:95} foi o primeiro livro a usar o termo ``mau cheiro de código''. No livro são apresentadas diversas más práticas em Orientação a Objetos. Longos métodos e complexidade excessiva são dois exemplos. 

Entretanto, o termo se popularizou no livro \textit{Refatoração: Aperfeiçoando o Projeto de Código Existente} (Fowler, M 1999) \cite{Refactoring:99}. Refatoração, segundo Fowler, é o ato de alterarmos o código sem alterar seu comportamento com o objetivo de torná-lo mais fácil de ser entendido e menos custoso de ser modificado. No livro são apresentadas diversas técnicas de  refatoração. O termo mau cheiro é usado para explicar ao leitor o ``\textit{quando}'' uma refatoração deve ser aplicada. Segundo o livro, \textbf{\textit{``mau cheiro de código são indicações de que existe um problema que pode ser resolvido por meio de uma refatoração''}}. Essas indicações provém do conhecimento empírico de desenvolvedores experientes, que ao longo dos anos, após trabalharem em diversos códigos bons e ruins, são capazes de listar características que podem indicar se um trecho de código é problemático. 

Em uma postagem em seu site oficial em 2006 \cite{CodeSmell:06}, Fowler afrouxou um pouco mais a definição do termo dizendo que \textit{``um mau cheiro de código são indicações superficiais que geralmente corresponde a um problema mais profundo no sistema''}.

No livro são apresentados 22 maus cheiros e mais de 70 técnicas de refatoração. \textit{Código Duplicado} \cite[p.~63]{Refactoring:99} é um exemplo de mau cheiro que trata de problemas comuns que podem resultar na duplicação de código, por exemplo, ter a mesma expressão em dois métodos da mesma classe ou em duas subclasses irmãs. Para resolver este mau cheiro é indicada a refatoração \textit{Extrair Método} \cite[p.~89]{Refactoring:99}, ou seja, extrair a expressão duplicada para um novo método e substituí-lo nos lugares onde a expressão era usada. 

Nos anos seguintes o termo mau cheiro se tornou frequente em livros \cite{CleanCode:08, Refactoring:14} e pesquisas acadêmicas. No livro \textit{Clean Code} (Martin, R 2008) \cite{CleanCode:08}, que se tornou muito popular entre desenvolvedores de software, são definidos novos maus cheiros além de citar alguns já apresentados por Fowler \cite{Refactoring:99}. Ele se apoia na definição de Fowler para explicar o conceito de mau cheiro.


% \subsection{Definindo Novos Maus Cheiros}

%   Tão importante quanto saber o que é um mau cheiro é entender como identificá-lo, validá-lo e documentá-lo. Nas últimas 3 décadas este tema veem despertando a curiosidade de diversos pesquisadores ao redor do mundo.

%   É possível perceber que a identificação parte de coleta de dados empíricos, por meio de questionários e entrevistas.  

\subsection{Formato dos Maus Cheiros}

  Os primeiros maus cheiros definidos vieram em formato textual e diferentemente de padrões, não parece existir guias de como documentar um mau cheiro. 

  Fowler \cite{Refactoring:99} por exemplo, se utiliza de \textit{título} e um \textit{texto explicativo}. No \textit{texto explicativo}, é possível encontrarmos informações sobre contexto, exemplos de problemas comuns e possíveis refatorações, dentre as listadas no livro, que resolveriam o mau cheiro. A seguir, temos o mau cheiro \textit{Código Duplicado} \cite[p.~71]{Refactoring:99}. O \textit{título} do mau cheiro parece indicar o problema por ele indicado. No parágrafo (1) podemos observar uma breve resumo do que faz cheirar mal e uma possível refatoração. Nos parágrafos seguintes (2-4) são apresentadas em mais detalhes situações comuns que podem indicar a presença do mau cheiro. \\

  \begin{leftbar}
    \textbf{Código Duplicado}

    (1) O número um no \textit{ranking} dos cheiros é o código duplicado. Se você vir o mesmo código em mais de um lugar, pode ter certeza de que seu programa será melhor se você encontrar uma maneira de unificá-los. 

    (2) O problema mais simples de código duplicado é quando você tem a mesma expressão em dois métodos da mesma classe. Tudo o que você tem que fazer então é utilizar o \textit{Extrair Método} e chamar o código de ambos os lugares. 

    (3) Outro problema de duplicação comum é quando você tem a mesma expressão em duas subclasses irmãs. Você pode eliminar essa duplicação usando \textit{Extrair Método} em ambas as classes e então \textit{Subir Método na Hierarquia}. Se o código for similar mas não o mesmo, você precisa usar \textit{Extrair Método} para separar as partes semelhantes daquelas diferentes. Você pode então descobrir que pode usar \textit{Criar um Método Padrão}. Se os métodos fazem a mesma coisa com um algoritmo diferente, você pode escolher o mais claro deles e usar \textit{Substituir o Algoritmo}.

    (4) Se você tem código duplicado em duas classes não relacionadas, considere usar \textit{Extrair Classe} em uma classe e então usar o novo componente na outra. Uma outra possibilidade é de que o método realmente pertença a apenas uma das classes e deva ser chamado pela outra ou que o método pertença a uma terceira classe que deva ser referida por ambas as classes originais. Você tem que decidir onde o método faz mais sentido e garantir que ele esteja lá e em mais nenhum lugar.
  \end{leftbar}

  Martin \cite{CleanCode:08} usa a mesma estrutura usada por Fowler e adiciona a ela uma \textit{sigla}. O \textit{texto explicativo} é apresentado em parágrafo único e é possível encontrar contexto, alguns exemplos de problemas comuns e exemplos de código, sendo que alguns maus cheiros apresentam todas essas informações ou apenas uma combinação delas. O \textit{título} usado por Martin aponta de certa forma o problema (o uso de convenção durante o desenvolvimento) e a solução (sempre que possível, preferir o uso de estruturas acima da convenção). 

  A seguir temos o mau cheiro \textit{G27: Estrutura acima de convenção} \cite[p.~301]{CleanCode:08}. No \textit{texto explicativo} em parágrafo único, podemos observar em orações a mesma estrutura que vimos no mau cheiro anterior, porém em parágrafos. Na oração (1) temos algo relacionado ao que faz cheirar mal, na oração (2) uma possível refatoração, na (3) é dado um exemplo e na (4) é indicado o problema resultante de se basear em convenção. \\

  \begin{leftbar}
    \textbf{G27: Estrutura acima de convenção}

    (1) Insista para que as decisões do projeto baseiem-se em estrutura acima de convenção. (2) Convenções de nomenclaturas são boas, mas são inferiores a estruturas, que forçam um certo cumprimento. (3) Por exemplo, \texttt{switch/case} com enumerações bem nomeadas são inferiores a classes base com métodos abstratos. (4) Ninguém é obrigado a implementar a estrutura \texttt{switch/case} da mesma forma o tempo todo; mas as classes bases obrigam a implementação de todos os métodos abstratos das classes concretas.
  \end{leftbar}

  Em pesquisas que definem novos maus cheiros, observamos um formato similar aos mencionados porém, adicionado uma estratégia de detecção, com foco em automatizar a identificação do mau cheiro \cite{MvcSmells:16, CSSCodeSmell}. Estas estratégias comumente se baseiam em métricas de software já existentes, como as mencionadas na sessão Métricas X.X.



\subsection{Qual a relação de práticas, padrões/anti-padrões e meus cheiros?}

Para entender melhor o que seria um mau cheiro e sua relação com padrões, antipadrões e práticas, pense no seguinte cenário: você na rua observa um homem correndo com uma bolsa feminina e uma mulher correndo atrás dele. Este cenário facilmente pode se encaixar num contexto de um homem que rouba a bolsa de uma mulher, e por padrão, ao vermos uma situação como esta, provavelmente devemos chamar a polícia. Mas este mesmo cenário pode representar um casal com pressa de pegar um ônibus ou táxi por exemplo, e neste contexto, não precisamos fazer nada.

Podemos pensar que o cenário que descrevemos representa um mau cheiro de forma que, ele não é um problema, mas pode apontar para problemas mais profundos ou não, mas que certamente vale uma análise para chegar a essas conclusões. Veja que, se for identificado que é um roubo, podemos então aplicar um padrão: ``chamar a polícia''. Logo, um mau cheiro pode representar um \textbf{contexto} de um padrão (ou anti-padrão), sendo assim, pode ser que a aplicação do padrão o resolva. Entretanto, pode ser que não exista ainda nenhum padrão para resolver o mau cheiro, então uma solução terá de ser criada.



% BIO
% =================================================================

% PRATICAS
% [1] https://dicionariodoaurelio.com/pratica
% [2] https://en.wikipedia.org/wiki/Best_practice #Critique
% [3] http://www.farrell-associates.com.au/Papers/Best%20Practice.pdf


% PADROES
% [1] mono ita 


% ANTI-PADROES
% [1]  Koenig, Andrew (MarchApril 1995). "Patterns and Antipatterns". Journal of Object-Oriented Programming. 8 (1): 4648.; was later re-printed in the: Rising, Linda (1998). The patterns handbook: techniques, strategies, and applications. Cambridge, U.K.: Cambridge University Press. p. 387. ISBN 0-521-64818-1. "An antipattern is just like a pattern, except that instead of a solution it gives something that looks superficially like a solution, but isn't one."
% Buscar mais aqui https://en.wikipedia.org/wiki/Anti-pattern#Software_engineering