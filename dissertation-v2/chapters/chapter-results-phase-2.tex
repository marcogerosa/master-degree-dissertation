% -*- root: dissertation.tex -*-
\section{QP$_2$ Importância e Frequência dos Maus Cheiros Android}
\label{phase2-results}

% Participaram desta etapa da pesquisa 201 desenvolvedores de 3 continentes e 14 países diferentes. Brasileiros representam 78\%, e vieram de 18 estados diferentes. Deste modo, apesar da abrangência geográfica, entendemos que os resultados expressam majoritariamente a percepção de desenvolvedores brasileiros. 15\% dos participantes possuem uma ou mais pós-graduações e 61\% são graduados. 57\% possuem de 20 a 35 anos. 

Nossos resultados mostraram que os 20 maus cheiros propostos são considerados, em diferentes níveis, importantes e se apresentam com diferentes frequências no dia a dia do desenvolvimento Android. As distribuições relativas de frequência e importância, sobre cada afirmação apresentada no questionário, pode ser conferida nos Apêndices \ref{appendix-phase2-frequence-table} (afirmações de frequência) e \ref{appendix-phase2-importance-table} (afirmações de importância).

% Para os maus cheiros que foram apresentadas no questionário mais de uma afirmação de importância ou frequência, se mostraram com distribuição relativa muito semelhantes, variando de 6\% a no máximo 10\% de uma afirmação a outra.

\subsection{Resultados Gerais}
\label{phase2-general-results} 

Para análise dos maus cheiros extraímos dados estatísticos de moda (MO), média (ME) e desvio padrão (DP) de importância e frequência para cada um dos maus cheiros derivados. Utilizamos a MO como um classificador do mau cheiro, ou seja, se ele recebeu majoritariamente a resposta ``importante'', o classificamos como importante. Estes dados são apresentados na Tabela \ref{tab:SmellFrequencyImportance} onde podemos observar que todos os maus cheiros apresentam MO de importância maior ou igual a 3, ou seja, de ``razoavelmente importante'' a ``muito importante''. Em contrapartida, com relação a frequência, três maus cheiros (\textsc{\small Adapter Consumista}, \textsc{\small Listener Escondido} e \textsc{\small Não Uso de Fragment}) apresentaram MO igual a 2, ``raramente'', todos os demais apresentaram MO maior ou igual a 3, ou seja, de ``ás vezes'' até ``muito frequente''. 

\begin{table}[!htb]
\centering
\renewcommand*{\arraystretch}{1}
\footnotesize 
\caption{Média (ME), moda (MO) e desvio padrão (DP) sobre a percepção da importância dos maus cheiros relacionados a componentes da camada de apresentação Android.}
\begin{tabular}{@{}p{9cm}cccp{.5cm}ccc@{}}
\toprule
\multirow{2}{*}{\textbf{Mau Cheiro}} & \multicolumn{3}{c}{\textbf{Importância}} & & \multicolumn{3}{c}{\textbf{Frequência}} \\ \cmidrule{2-4} \cmidrule{6-8}
                                      & \textbf{ME} & \textbf{MO} & \textbf{DP} & & \textbf{ME} & \textbf{MO} & \textbf{DP} \\
\bottomrule
\textsc{Componente de UI Cérebro} & 5 & 5 & 1,05 & & 3 & 4 & 1,19 \\ 
\textsc{Recurso Mágico} & 4 & 5 & 1,00 & & 3 & 4 & 1,24 \\ 
\textsc{Imagem Tradicional Dispensável} & 4 & 5 & 0,95 & & 3 & 4 & 1,23 \\ 
\textsc{Layout Longo ou Repetido} & 4 & 5 & 0,95 & & 4 & 4 & 1,07 \\ 
\textsc{Imagem Faltante} & 5 & 5 & 0,95 & & 3 & 4 & 1,25 \\ 
\textsc{Componente de UI Acoplado} & 4 & 5 & 1,02 & & 3 & 3 & 1,15 \\ 
\textsc{Classes de UI Fazendo IO} & 5 & 5 & 1,03 & & 3 & 3 & 1,29 \\ 
% \textsc{Componente de UI Zumbi} & 5 & 5 & 0,88 & & 3 & 3 & 1,16 \\ 
\textsc{Ausência de Arquitetura} & 5 & 5 & 0,82 & & 3 & 3 & 1,30 \\ 
\textsc{Adapter Complexo} & 4 & 5 & 0,91 & & 3 & 3 & 1,15 \\ 
\textsc{Nome de Recurso Despadronizado} & 5 & 5 & 0,88 & & 3 & 3 & 1,24 \\ 
\textsc{Adapter Consumista} & 5 & 5 & 0,93 & & 2 & 2 & 1,20 \\ 
\textsc{Listener Escondido} & 4 & 5 & 1,23 & & 2 & 2 & 1,29 \\ 
\textsc{Longo Recurso de Estilo} & 4 & 4 & 1,06 & & 4 & 5 & 1,18 \\ 
\textsc{Recurso de String Bagunçado} & 3 & 4 & 1,22 & & 4 & 5 & 1,18 \\ 
\textsc{Comportamento Suspeito} & 3 & 4 & 1,19 & & 3 & 4 & 1,19 \\ 
\textsc{Layout Profundamente Aninhado} & 4 & 4 & 1,12 & & 4 & 4 & 1,06 \\ 
\textsc{Atributos de Estilo Repetidos} & 4 & 4 & 0,86 & & 4 & 4 & 1,11 \\ 
\textsc{Não Uso de Fragment} & 3 & 4 & 1,34 & & 3 & 2 & 1,21 \\ 
\textsc{Reuso Inadequado de String} & 3 & 3 & 1,29 & & 4 & 4 & 1,12 \\ 
\textsc{Uso Excessivo de Fragment} & 3 & 3 & 1,36 & & 3 & 3 & 1,17 \\  
\toprule
DP Médio &  &  & 1.05 &  & &  & 1.19 \\ 
% \toprule
% \multicolumn{8}{@{}l@{}}{DP = Desvio Padrão, MO = Moda, ME = Média.} \\
\bottomrule
\end{tabular}
\label{tab:SmellFrequencyImportance}
\end{table}


Entendemos este resultado de forma positiva pois, apesar de alguns sintomas não serem tão frequentes, ainda assim são considerados com algum nível de importância de se mitigar, reforçando também a relevância desta pesquisa pois damos os primeiros passos no sentido da automatização da identificação desses maus cheiros. Com base no DP, podemos observar que, de modo geral, existe uma concordância maior sobre a importância dos maus cheiros do que sobre a frequência, pois a média do DP de importância é de 1,05, ligeiramente menor que a média do DP de frequência, que é de 1,19. 

Quanto menor o DP maior a concordância entre os participantes sobre determinado mau cheiro. Podemos observar que os maus cheiros que tiveram maior concordância com relação a sua importância foram: \textsc{\small Adapter Complexo}, \textsc{\small Adapter Consumista}, \textsc{\small Atributos de Estilo Repetidos}, \textsc{\small Ausência de Arquitetura}, \textsc{\small Imagem Faltante}, \textsc{\small Imagem Tradicional Dispensável}, \textsc{\small Layout Longo ou Repetido}, \textsc{\small Nome de Recurso Despadronizado}, todos com DP menor que 1. Sobre a concordância com relação a frequência, nenhum dos maus cheiros obteve DP menor que 1, mas os mais próximos, indicando maior concordância sobre sua frequência são: \textsc{\small Layout Profundamente Aninhado} com DP de 1,06 e \textsc{\small Longo Recurso de Estilo} com DP 1,07. 


\subsection{Importância dos Maus Cheiros}

Para análise dos dados, simplificamos a escala \textit{likert} de importância de modo que, os maus cheiros de MO 3, ``razoavelmente importante'', são classificados como sendo de \textbf{\small importância moderada}, os maus cheiros de MO 4 ou 5, respectivamente ``importante'' e ``muito importante'', são classificados de \textbf{\small importância alta}. Nenhum mau cheiro teve MO 1 ou 2, respectivamente ``não é importante'' e ``pouco importante'', logo, não criamos classificações para essas opções. 

A Tabela \ref{tab:SmellImportance} apresenta a lista dos maus cheiros de acordo com seu nível de importância, alta ou moderada. Podemos observar que as duas primeiras colunas contém os 18 maus cheiros classificados com \textbf{\small importância alta}. Dentre eles, a maioria dos maus cheiros (10) afetam recursos Android: \textsc{\small Longo Recurso de Estilo}, \textsc{\small Layout Profundamente Aninhado}, \textsc{\small Atributos de Estilo Repetidos}, \textsc{\small Nome de Recurso Despadronizado}, \textsc{\small Recurso Mágico}, \textsc{\small Imagem Faltante}, \textsc{\small Imagem Tradicional Dispensável}, \textsc{\small Layout Longo ou Repetido}, \textsc{\small Recurso de String Bagunçado} e \textsc{\small Listener Escondido}.

\begin{table}[!htb]
\centering
\renewcommand*{\arraystretch}{1}
\footnotesize 
\caption{Listagem dos maus cheiros da camada de apresentação Android de acordo com seu nível de importância, alta ou moderada.}
\begin{tabular}{@{}p{5.2cm}p{5.2cm}p{5.2cm}@{}}
\toprule
\multicolumn{2}{c}{\textbf{Importância Alta}} & \multicolumn{1}{c}{\textbf{Importância Moderada}}  \\ 
\bottomrule
\textsc{\scriptsize Adapter Complexo}              & \textsc{\scriptsize Atributos de Estilo Repetidos} & \textsc{\scriptsize Reuso Inadequado de String} \\ 
\textsc{\scriptsize Adapter Consumista}            & \textsc{\scriptsize Comportamento Suspeito}        & \textsc{\scriptsize Uso Excessivo de Fragment} \\ 
\textsc{\scriptsize Ausência de Arquitetura}       & \textsc{\scriptsize Layout Profundamente Aninhado} \\ 
\textsc{\scriptsize Classes de UI Fazendo IO}      & \textsc{\scriptsize Longo Recurso de Estilo}       \\ 
\textsc{\scriptsize Componente de UI Acoplado}     & \textsc{\scriptsize Não Uso de Fragment}           \\ 
\textsc{\scriptsize Componente de UI Cérebro}      & \textsc{\scriptsize Recurso de String Bagunçado}   \\ 
\textsc{\scriptsize Recurso Mágico}                & \textsc{\scriptsize Imagem Faltante}               \\ 
\textsc{\scriptsize Imagem Tradicional Dispensável}& \textsc{\scriptsize Layout Longo ou Repetido}      \\ 
\textsc{\scriptsize Listener Escondido}            & \textsc{\scriptsize Nome de Recurso Despadronizado}\\ 
\toprule
\multicolumn{2}{c}{18} & \multicolumn{1}{c}{2}  \\ 
\bottomrule
\end{tabular}
\label{tab:SmellImportance}
\end{table}

Enquanto que 8 dos maus cheiros de \textbf{\small importância alta} afetam componentes da camada de apresentação Android: \textsc{\small Adapter Complexo}, \textsc{\small Adapter Consumista}, \textsc{\small Ausência de Arquitetura}, \textsc{\small Classes de UI Fazendo IO}, \textsc{\small Componente de UI Cérebro}, \textsc{\small Atributos de Estilo Repetidos}, \textsc{\small Comportamento Suspeito} e \textsc{\small Não Uso de Fragment}. Apenas 2 maus cheiros: \textsc{\small Reuso Inadequado de String} e \textsc{\small Uso Excessivo de Fragment}, listados na última coluna da tabela, são de \textbf{\small importância moderada}, sendo 1 relacionado a recursos e outro componentes da camada de apresentação Android. 

A Figura \ref{fig:phase2-results-importance} apresenta a distribuição relativa de importância dos maus cheiros. Apresentamos negativo (em vermelho) o percentual relacionado as respostas ``não é importante''. 

\begin{figure*}[!htb]
  \centering
  \includegraphics[width=1\textwidth]{phase2-results-importance2.png}
  \caption{Distribuição relativa de importância dos 20 maus cheiros derivados.}
  \label{fig:phase2-results-importance}
  % \vspace{-.5cm} 
\end{figure*}

Os três maus cheiros que obtiveram mais respostas de ``não é importante'' foram: \textsc{\small Reuso Inadequado de String}, \textsc{\small Não Uso de Fragment}, \textsc{\small Uso Excessivo de Fragment}. São os mesmo que tiveram menor concordância com relação a sua importância, todos com DP acima de 1,28.


\subsection{Frequência dos Maus Cheiros}

Para análise dos dados, simplificamos a escala \textit{likert} de frequência de modo similar ao de importância, onde maus cheiros de MO 2, ``raramente'', são classificados como \textbf{\small frequência baixa}, os maus cheiros de MO 3, ``ás vezes'', são classificados como \textbf{\small frequência moderada} e os maus cheiros de MO 4 ou 5, respectivamente ``frequente'' e ``muito frequente'', são classificados de \textbf{\small frequência alta}. Nenhum mau cheiro teve MO 1, ``nunca'', e portanto não criamos classificação para essa opção. A Tabela \ref{tab:SmellFrequency} apresenta a lista dos maus cheiros de acordo com seu nível de frequência, alta, moderada ou baixa. 

\begin{table}[!htb]
\centering
\renewcommand*{\arraystretch}{1}
\footnotesize 
\caption{Listagem dos maus cheiros da camada de apresentação Android de acordo com seu nível de frequência, alta, moderada ou baixa.}
\begin{tabular}{@{}p{5.2cm}p{5.2cm}p{5.2cm}@{}}
\toprule
\multicolumn{1}{c}{\textbf{Frequência Alta}} & \multicolumn{1}{c}{\textbf{Frequência Moderada}} & \multicolumn{1}{c}{\textbf{Frequência Baixa}} \\ 
\bottomrule
\textsc{\scriptsize Atributos de Estilo Repetidos}  & \textsc{\scriptsize Adapter Complexo}               & \textsc{\scriptsize Adapter Consumista} \\ 
\textsc{\scriptsize Componente de UI Cérebro}       & \textsc{\scriptsize Ausência de Arquitetura}        & \textsc{\scriptsize Listener Escondido} \\ 
\textsc{\scriptsize Imagem Faltante}                & \textsc{\scriptsize Classes de UI Fazendo IO}       & \textsc{\scriptsize Não Uso de Fragment} \\ 
\textsc{\scriptsize Imagem Tradicional Dispensável} & \textsc{\scriptsize Componente de UI Acoplado}      \\ 
\textsc{\scriptsize Layout Longo ou Repetido}       & \textsc{\scriptsize Uso Excessivo de Fragment}      \\ 
\textsc{\scriptsize Layout Profundamente Aninhado}  & \textsc{\scriptsize Comportamento Suspeito}         \\ 
\textsc{\scriptsize Longo Recurso de Estilo}        & \textsc{\scriptsize Nome de Recurso Despadronizado} \\ 
\textsc{\scriptsize Recurso Mágico}                 \\ 
\textsc{\scriptsize Reuso Inadequado de String}     \\ 
\textsc{\scriptsize Recurso de String Bagunçado}    \\ 
\toprule
\multicolumn{1}{c}{10} & \multicolumn{1}{c}{7} & \multicolumn{1}{c}{3}\\ 
\bottomrule
\end{tabular}
\label{tab:SmellFrequency}
\end{table}

É interessante notar que, maus cheiros em recursos são percebidos mais frequentemente que os maus cheiros em componentes da camada de apresentação Android. Podemos observar na Tabela \ref{tab:SmellFrequency} que, 9 dentre os 10 maus cheiros de \textbf{\small frequência alta} são em recursos Android: \textsc{\small Atributos de Estilo Repetidos}, \textsc{\small Imagem Faltante}, \textsc{\small Imagem Tradicional Dispensável}, \textsc{\small Layout Longo ou Repetido}, \textsc{\small Layout Profundamente Aninhado}, \textsc{\small Longo Recurso de Estilo}, \textsc{\small Recurso Mágico}, \textsc{\small Reuso Inadequado de String} e \textsc{\small Recurso de String Bagunçado}. Enquanto que apenas o mau cheiro de \textbf{\small frequência alta}, \textsc{\small Componente de UI Cérebro}, é relacionado a componentes da camada de apresentação Android.

Nos demais níveis de frequência, essa situação se inverte, sendo os maus cheiros em componentes da camada de apresentação Android, maioria. Dentre os maus cheiros de \textbf{\small frequência moderada}, 6 dentre os 7 são relacionados a componentes: \textsc{\small Adapter Complexo}, \textsc{\small Ausência de Arquitetura}, \textsc{\small Classes de UI Fazendo IO}, \textsc{\small Componente de UI Acoplado}, \textsc{\small Uso Excessivo de Fragment} e \textsc{\small Comportamento Suspeito}. Apenas o mau cheiro \textsc{\small Nome de Recurso Despadronizado} é relacionado a recursos Android. Dentre os maus cheiro de \textbf{\small frequência baixa}, 2 dentre os 3 são relacionados a componentes da camada de apresentação Android: \textsc{\small Adapter Consumista} e \textsc{\small Não Uso de Fragment}. E apenas o mau cheiro \textsc{\small Listener Escondido} é relacionado a recursos Android.

\begin{figure*}[!htb]
  \centering
  \includegraphics[width=.85\textwidth]{phase2-results-frequence.png}
  \caption{Distribuição relativa de frequência dos 20 maus cheiros derivados.}
  \label{fig:phase2-survey-frequence}
  % \vspace{-.5cm} 
\end{figure*}

A Figura \ref{fig:phase2-survey-frequence} apresenta a distribuição relativa de frequência dos maus cheiros. Apresentamos negativo (em vermelho) o percentual relacionado as respostas ``nunca''. Os maus cheiros que obtiveram mais respostas de ``nunca'' foram: \textsc{\small Adapter Consumista} (25\%) seguido por \textsc{\small Listener Escondido} (24\%). Em todo caso, é possível notar que todos os maus cheiros nunca foram vistos por uma parcela, no geral pequena, de desenvolvedores. Mas para a maioria dos desenvolvedores, todos os maus cheiros estão em algum nível de frequência, presentes no seu dia a dia.


\subsection{Discussões}




\begin{square}
  \small
  Nossos resultados mostram que os maus cheiros propostos são considerados importantes e frequentes no dia a dia do desenvolvimento Android (QP$_2$). 
\end{square}

