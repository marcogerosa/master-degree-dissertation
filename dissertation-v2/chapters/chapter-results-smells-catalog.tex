% -*- root: dissertation.tex -*-
\section{Catálogo de Maus Cheiros Android}
Nesta seção apresentamos as definições dos 13 maus cheiros derivados após as três etapas de pesquisa.

\subsection{Maus Cheiros em Componentes do Front-End}
    % Obtivemos 4 categorias consideradas de alta recorrência: Classe de UI Inteligente, Nome de Recurso Despadronizado, Recurso Mágico e Layout Profundamente Aninhado.
    Nesta seção apresentamos o catálogo de maus cheiros que afetam componentes do \textit{front-end} Android, podendo ser: \textit{Activities}, \textit{Fragments}, \textit{Adapters} ou \textit{Listeners}.

    % \subsection{\textsc{Classe de UI Inteligente (SML-J1)$^{20\star}$}}
    \subsubsection[Classe de UI Inteligente]{\textsc{Classe de UI Inteligente (SML-J1)$^{20\star}$}}
        \label{subsec:logica-classes-ui}
        \textsc{Activities}$^{10\star}$, \textsc{Fragments}$^{6\star}$, \textsc{Adapters}$^{5\star}$ e \textsc{Listeners}$^{1\star}$ devem conter apenas códigos responsáveis por apresentar, interagir e atualizar a UI. São indícios do mau cheiro a existência de códigos relacionados a lógica de negócio, operações de IO\footnote{ver mau cheiro \textsc{Classes de UI Fazendo IO} \ref{subsce:classes-ui-fazendo-io}.}, conversão de dados ou campos estáticos nesses elementos.

        Alguns exemplos de frases sobre \textbf{más práticas} que embasaram esse mau cheiro são: \textit{``Fazer lógica de negócio [em Activities]''}\footnote{Todo texto em inglês foi traduzido livremente ao longo da dissertação} (P16). \textit{``Colocar regra de negócio no Adapter''} (P19). \textit{``Manter lógica de negócio em Fragments''} (P11). E frases sobre \textbf{boas práticas}: \textit{``Elas [Activities] representam uma única tela e apenas interagem com a UI, qualquer lógica deve ser delegada para outra classe''} (P16). \textit{``Apenas código relacionado à Interface de Usuário nas Activities''} (P23). \textit{``Adapters devem apenas se preocupar sobre como mostrar os dados, sem trabalhá-los''} (P40). 

    \subsubsection[Classes de UI Acopladas]{\textsc{Classes de UI Acopladas (SML-J2)$^{6\star}$}}
        \textsc{Fragments}$^{4\star}$, \textsc{Adapters}$^{1\star}$ e \textsc{Listeners}$^{1\star}$ não devem ter referência direta para quem os utiliza. São indícios do mau cheiro a existência de referência direta para \textsc{Activities} ou \textsc{Fragments} nesses elementos. 

        Alguns exemplos de frases sobre \textbf{más práticas} que embasaram esse mau cheiro são: \textit{``Acoplar o fragment a activity ao invés de utilizar interfaces é uma prática ruim''} (P19). \textit{``Acoplar o Fragment com a Activity''} (P10, P31 e P45). \textit{``Fragments nunca devem tentar falar uns com os outros diretamente''} (P37). \textit{``Integragir com outro Fragment diretamente''} (P45). \textit{``[Listener] conter uma referência direta à Activities''} (P4, P40). \textit{``[Adapters] alto acoplamento com a Activity''} (P10). \textit{``Acessar Activities ou Fragments diretamente''} (P45). E sobre \textbf{boa prática}: \textit{``Seja um componente de UI reutilizável. Então evite dependência de outros componentes da aplicação''} (P6).

    \subsubsection[Comportamento Suspeito]{\textsc{Comportamento Suspeito (SML-J3)$^{6\star}$}}
        \textsc{Activities}$^{3\star}$, \textsc{Fragments}$^{2\star}$ e \textsc{Adapters}$^{1\star}$ não devem ser responsáveis pela implementação do comportamento dos eventos. São indícios do mau cheiro o uso de classes anônimas, classes internas ou polimorfismo (através de \texttt{implements}) para implementar \textsc{Listeners} de modo a responder a eventos do usuário.

        Alguns exemplos de frases sobre \textbf{más práticas} que embasaram esse mau cheiro são: \textit{``Usar muitos anônimos pode ser complicado. Às vezes nomear coisas torna mais fácil para depuração''} (P9). \textit{``Mantenha-os [Listeners] em classes separadas (esqueça sobre classes anônimas)''} (P4). \textit{``Muitas implementações de Listener com classes anônimas''} (P8). \textit{``Declarar como classe interna da Activity ou Fragment ou outro componente que contém um ciclo de vida. Isso pode fazer com que os aplicativos causem vazamentos de memória.''} (P42). \textit{``Eu não gosto quando os desenvolvedores fazem a activity implementar o Listener porque eles [os métodos] serão expostos e qualquer um pode chamá-lo de fora da classe. Eu prefiro instanciar ou então usar ButterKnife\footnote{Biblioteca de injeção de dependência de código aberto, \url{http://jakewharton.github.io/butterknife}} para injetar cliques.''} (P44). E sobre \textbf{boas práticas}: \textit{``Prefiro declarar os listeners com implements e sobrescrever os métodos (onClick, por exemplo) do que fazer um set listener no próprio objeto''} (P32). \textit{``Tome cuidade se a Activity/Fragment é um Listener uma vez que eles são destruídos quando as configurações mudam. Isso causa vazamentos de memória.''} (P6). \textit{``Use carregamento automático de view como ButterKnife e injeção de dependência como Dagger2''} (P10).

    \subsubsection[Entenda o Ciclo de Vida]{\textsc{Entenda o Ciclo de Vida (SML-J4)$^{5\star}$}}
        O Ciclo de Vida de \textsc{Activities}$^{3\star}$ e \textsc{Fragments}$^{3\star}$ é bem delicado e elaborado, logo o uso dele exige um conhecimento mais profundo, caso contrário pode resultar em \textit{memory leaks} e outros problemas. São indícios do mau cheiro ter estes elementos como \textit{callbacks} de processos assíncronos, efetivar a transação de \textsc{Fragments} (através do \texttt{FragmentTransaction.commit}) após o \texttt{onPause} da \textsc{Activity} ou o não tratamento da restauração do estado de \textsc{Activities} e \textsc{Fragments} após por exemplo, rotação da tela.

        Alguns exemplos de frases sobre \textbf{más práticas} que embasaram esse mau cheiro são: \textit{``Não conhecer o enorme e complexo ciclo de vida de Fragment e não lidar com a restauração do estado''} (P42). \textit{``Não commitar fragmentos após o onPause e aprender o ciclo de vida se você quiser usá-los''} (P31). \textit{``Fazer Activities serem callbacks de processos assíncronos gerando memory leaks. Erros ao interpretar o ciclo de vida''} (P28). 

    \subsubsection[Classes de UI Fazendo IO]{\textsc{Classes de UI Fazendo IO (SML-J8)$^{3\star}$}}
        \label{subsce:classes-ui-fazendo-io}
        \textsc{Activities}$^{2\star}$, \textsc{Fragments}$^{1\star}$ e \textsc{Adapters}$^{1\star}$ não devem ser responsáveis por operações de IO. São indícios do mau cheiro implementações de acesso a banco de dados ou internet a partir desses elementos.

        Alguns exemplos de frases sobre \textbf{más práticas} que embasaram esse mau cheiro são: \textit{``[Activities e Fragments] fazerem requests e consultas a banco de dados''} (P26). \textit{``[Adapters] fazerem operações longas e requests de internet''} (P26). E sobre \textbf{boa prática}: \textit{``Elas [Activities] nunca devem fazer acesso a dados''} (P37).

    \subsubsection[Componente de UI Zumbi]{\textsc{Componente de UI Zumbi (SML-J9)$^{2\star}$}}
        \textsc{Activities}$^{2\star}$ podem deixar de existir a qualquer momento, tenha cuidado ao referenciá-las. São indícios do mau cheiro a existência de referências estáticas a \textsc{Activities} ou classes internas a ela ou referências não estáticas por objetos que tenham o ciclo de vida independente dela.

        Alguns exemplos de frases sobre \textbf{más práticas} que embasaram esse mau cheiro são: \textit{``Fazer Activities serem callbacks de processos assíncronos gerando memory leaks. Erros ao interpretar o ciclo de vida''} (P28). \textit{``Ter referência estática para Activities, resultando em vazamento de memória''} (P31). E sobre \textbf{boas práticas}: \textit{``Não manter referências estáticas para Activities (ou classes anônimas criadas dentro delas)''} (P31). \textit{``Deus mata um cachorro toda vez que alguém passa o contexto da Activity para um componente que tem um ciclo de vida independente dela. Vaza memória e deixa todos tristes.''} (P4).

    \subsubsection[Arquitetura Não Identificada]{\textsc{Arquitetura Não Identificada (SML-J10)$^{2\star}$}}
        São indícios do mau cheiro quando diferentes \textsc{Activities}$^{2\star}$ e \textsc{Fragments}$^{1\star}$ no projeto apresentam fluxos de código complexos, possivelmente são \textsc{Classe de UI Inteligente} \ref{subsec:logica-classes-ui}, onde não é possível identificar uma organização padronizada entre eles que aponte para algum padrão arquitetural, como por exemplo, MVC (\textit{Model View Controller}), MVP (\textit{Model View Presenter}), MVVM (\textit{Model View ViewModel}) ou \textit{Clean Architecture}.

        Um exemplo de frase sobre \textbf{má prática} que embasou esse mau cheiro é: \textit{``Não usar um design pattern''} (P45). E frases sobre \textbf{boas práticas}: \textit{``Usar algum modelo de arquitetura para garantir apresentação desacoplada do framework (MVP, MVVM, Clean Architecture, etc)''} (P28). \textit{``Sobre MVP. Eu acho que é o melhor padrão de projeto para usar com Android''} (P45).

    \subsubsection[Adapter Complexo]{\textsc{Adapter Complexo (SML-J11)$^{2\star}$}}
        \textsc{Adapters}$^{2\star}$ devem ser responsáveis por popular uma \texttt{view} a partir de um único objeto, sem realizar lógicas ou tomadas de decisão. São indícios desse mau cheiro quando \textsc{Adapters} contém muitos condicionais (\texttt{if} ou \texttt{switch}) ou cálculos no método \texttt{getView}, responsável pela construção e preenchimento da \texttt{view}. 

        Um exemplo de frase sobre \textbf{má prática} que embasou esse mau cheiro é: \textit{``Reutilizar um mesmo adapter para várias situações diferentes, com \texttt{ifs} ou \texttt{switches}. Código de lógica importante ou cálculos em Adapters.''} (P23). E sobre \textbf{boa prática}: \textit{``Um Adapter deve adaptar um único tipo de item ou delegar a Adapters especializados''} (P2).

\subsection{Maus Cheiros Em Recursos}
    Nesta seção apresentamos o catálogo com oito maus cheiros que afetam recursos do \textit{front-end} Android, podendo ser: recursos de \textit{layout}, recursos de \textit{string}. recursos de \textit{style} ou recursos \textit{drawable}.

    \subsubsection[Nome de Recurso Despadronizado]{\textsc{Nome de Recurso Despadronizado (SML-R2)$^{8\star}$}}
        São indícios do mau cheiro quando \textsc{Recursos de Layout}$^{2\star}$, \textsc{Recursos de Texto}$^{4\star}$, \textsc{Recursos de Estilo}$^{2\star}$ e \textsc{Recursos Gráficos}$^{1\star}$ não possuem um padrão de nomenclatura.

        Alguns exemplos de frases sobre \textbf{más práticas} que embasaram esse mau cheiro são: \textit{``O nome das strings sem um contexto''} (P8). \textit{``[Sobre Style Resources] Nada além de ter uma boa convenção de nomes''} (P37). \textit{``[Sobre Layout Resource] Mantenha uma convenção de nomes da sua escolha''} (P37). E sobre \textbf{boas práticas}: \textit{``Iniciar o nome de uma string com o nome da tela onde vai ser usada''} (P27). \textit{``[Sobre Layout Resource] Ter uma boa convenção de nomeação''} (P43). \textit{``[Sobre Style Resource] colocar um bom nome''} (P11). 

    \subsubsection[Layout Profundamente Aninhado]{\textsc{Layout Profundamente Aninhado (SML-R3)$^{7\star}$}} 
        São indícios desse mau cheiro o uso de profundos aninhamentos na construção de \textsc{Recursos de Layout}$^{7\star}$, ou seja, \texttt{ViewGroups} contendo outros \texttt{ViewGroups} sucessivas vezes. O site oficial do Android conta com informações e ferramentas automatizadas para lidar com esse sintoma \cite{OptmizingViewHierarchies}. 

        Alguns exemplos de frases sobre \textbf{más práticas} que embasaram esse mau cheiro são: \textit{``Hierarquia de views longas''} (P26). \textit{``Estruturas profundamente aninhadas''} (P4). \textit{``Hierarquias desnecessárias''} (P39). \textit{``Criar muitos ViewGroups dentro de ViewGroups''} (P45). E sobre \textbf{boas práticas}: \textit{``Tento usar o mínimo de layout aninhado''} (P4). \textit{``Utilizar o mínimo de camadas possível''} (P19). \textit{``Não fazer uma hierarquia profunda de ViewGroups''} (P8).

    \subsubsection[Imagem Dispensável]{\textsc{Imagem Dispensável (SML-R4)$^{6\star}$}}
        O Android possui diversos tipos de \textsc{Recursos Gráficos}$^{6\star}$ que podem substituir imagens tradicionais como \texttt{.png}, \texttt{.jpg} ou \texttt{.gif} a um custo menor em termos de tamanho do arquivo e sem a necessidade de haver versões de diferentes tamanhos/resoluções. São indícios do mau cheiro a existência de imagens com, por exemplo, cores sólidas, degradês ou estado de botões, que poderiam ser substituídas por \textsc{Recursos Gráficos} de outros tipos como \textsc{Shapes}, \textsc{State Lists} ou \textsc{Nine-Patch File} ou a não existência de imagens vetoriais, que podem ser redimensionadas sem a perda de qualidade.

        Alguns exemplos de frases sobre \textbf{más práticas} que embasaram esse mau cheiro são: \textit{``Uso de formatos não otimizados, uso de drawables onde recursos padrão do Android seriam preferíveis''} (P23). \textit{``Usar jpg ou png para formas simples é ruim, apenas as desenhe [através de Drawable Resources]''} (P37). E sobre \textbf{boas práticas}: \textit{``Quando possível, criar resources através de xml''} (P36). \textit{``Utilizar o máximo de Vector Drawables que for possível''} (P28). \textit{``Evite muitas imagens, use imagens vetoriais sempre que possível''} (P40).

    \subsubsection[Layout Longo ou Repetido]{\textsc{Layout Longo ou Repetido (SML-R5)$^{5\star}$}}
        São indícios do mau cheiro quando \textsc{Recursos de Layout}$^{5\star}$ é muito grande ou possue trechos de layout muito semelhantes ou iguais a outras telas. 

        Um exemplo de frase sobre \textbf{má prática} que embasou esse mau cheiro é: \textit{``Copiar e colar layouts parecidos sem usar includes''} (P41). \textit{``Colocar muitos recursos no mesmo arquivo de layout.''} (P23). E sobre \textbf{boas práticas}: \textit{``Sempre quando posso, estou utilizando includes para algum pedaço de layout semelhante''} (P32). \textit{``Criar layouts que possam ser reutilizados em diversas partes''} (P36). \textit{``Separe um grande layout usando include ou merge''} (P42) 

    \subsubsection[Imagem Faltante]{\textsc{Imagem Faltante (SML-R6)$^{4\star}$}}
        As imagens devem ser disponibilizadas em mais de um tamanho/resolução para que o Android possa realizar otimizações. São indícios do mau cheiro haver apenas uma versão de algum \textsc{Recursos Gráfico}$^{4\star}$ do tipo png, jpg ou gif ou ainda, ter imagens em diretórios incorretos em termos de \texttt{dpi}.

        Alguns exemplos de frases sobre \textbf{más práticas} que embasaram esse mau cheiro são: \textit{``Ter apenas uma imagem para multiplas densidades''} (P31). \textit{``Baixar uma imagem muito grande quando não é necessário. Há melhores formas de usar memória''} (P4). \textit{``Não criar imagens para todas as resoluções''} (P44).E sobre \textbf{boas prática}: \textit{``Nada especial, apenas mantê-las em seus respectivos diretórios e ter variados tamanhos delas''} (P34). \textit{``Criar as pastas para diversas resoluções e colocar as imagens corretas''} (P36). 

    \subsubsection[Longo Recurso de Estilo]{\textsc{Longo Recurso de Estilo (SML-R7)$^{3\star}$}}
        É indício do mau cheiro haver apenas um \textsc{Recurso de Estilo}$^{4\star}$ ou conter Recursos de Estilo muito longos.

        Alguns exemplos de frases sobre \textbf{más práticas} que embasaram esse mau cheiro são: \textit{``Deixar tudo no mesmo arquivo styles.xml''} (P28). \textit{``Arquivos de estilos grandes''} (P8). E sobre \textbf{boas práticas}: \textit{``Se possível, separar mais além do arquivo styles.xml padrão, já que é possível declarar múltiplos arquivos XML de estilo para a mesma configuração''} (P28). \textit{``Divida-os. Temas e estilos é uma escolha racional''} (P40).

    \subsubsection[Recurso de String Bagunçado]{\textsc{Recurso de String Bagunçado (SML-R8)$^{3\star}$}}
        É indício do mau cheiro o uso de apenas um arquivo para todos os \textsc{Recursos de Texto}$^{3\star}$ do aplicativo e a não existência de um padrão de nomenclatura e separação para os \textsc{Recursos de Texto} de uma mesma tela. 

        Alguns exemplos de frases sobre \textbf{más práticas} que embasaram esse mau cheiro são: \textit{``Usar o mesmo arquivo strings.xml para tudo''} (P28). \textit{``Não orgaizar as strings quando o strings.xml começa a ficar grande''} (P42). E sobre \textbf{boas práticas}: \textit{``Separar strings por tela em arquivos XML separados. Extremamente útil para identificar quais strings pertencentes a quais telas em projetos grandes''} (P28). \textit{``Sempre busco separar em blocos, cada bloco representa uma Activity e nunca aproveito uma String pra outra tela''} (P32).

    \subsubsection[Atributos de Estilo Repetidos]{\textsc{Atributos de Estilo Repetidos (SML-R9)$^{3\star}$}}
        É indício do mau cheiro haver \textsc{Recursos de Layout}$^{1\star}$ ou \textsc{Recursos de Estilo}$^{2\star}$ com blocos de atributos de estilo repetidos. 
        % , onde poderiam ser extraídos para um novo estilo e substituir o bloco de atributos repetidos pelo estilo criado.

        Um exemplo de frase sobre \textbf{má prática} que embasou esse mau cheiro é: \textit{``Utilizar muitas propriedades em um único componente. Se tiver que usar muitas, prefiro colocar no arquivo de styles.''} (P32). E sobre \textbf{boa prática}: \textit{``Sempre que eu noto que tenho mais de um recurso usando o mesmo estilo, eu tento movê-lo para o meu style resource.''} (P34).

    