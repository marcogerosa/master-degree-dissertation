% -*- root: dissertacao.tex -*-
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setlength{\parindent}{20pt}
\setlength{\textheight}{22cm}
\setlength{\parskip}{0.2cm}
\linespread{1.2} % Para aumentar o espaçamento entre as linhas
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Identificar o contexto e a motivação para o trabalho, especificar o problema, discutir trabalhos relacionados (principalmente as suas limitações), definir as contribuições, enfatizar os resultados principais e a organização do texto.

\chapter{Introdução}

No próximo ano o Android completará uma década desde seu primeiro lançamento em 2007 e não há dúvidas sobre o seu sucesso \cite{AppAnnie:16, PercentSmartphoneSales:09-16,SmartphoneSales:09-16}. Atualmente há disponível mais de 2 milhões de aplicativos Google Play Store, loja oficial de aplicativos Android \cite{AppInPlayStore:09-16}. Mais de 83,5\% dos \textit{devices} no mundo usam o sistema operacional móvel Android (plataforma Android), e este percentual vem crescendo ano após ano \cite{GrowthForecastIDC:16, MobileMarketShares:16}. Hoje podemos encontrá-lo em outros dispositivos como \textit{smart TVs}, \textit{smartphones}, carros, dentre outros \cite{AndroidAuto:16, AndroidSmart:14}. Estes dados somado a experiência do autor são os motivadores por esta tese se tratar desta plataforma.

Duas tarefas que desenvolvedores de software constantemente fazem é criar código novo e alterar código existente, em ambos os casos busca-se escrever código de qualidade. Para a primeira, criar código novo, desenvolvedores costumam se apoiar em boas práticas e \textit{design patterns} já estabelecidos \cite{alur2003core, rozanski2012software, gamma1994design}. Para a segunda, alterar código existente, um dos motivos pode ser refatorar, ou seja, tornar melhor o código sem alterar o comportamento \cite{RefactoringFowler1999}. Para isso, é comum se utilizar de estratégias de detecção de maus cheiros de código (\textit{code smells}), estes apontam trechos de códigos que podem se beneficiar de refatoração. Apesar de já existir um catálogo extenso de \textit{code smells} a maioria deles não considera a natureza do projeto e suas particularidades, muitos deles foram elaborados pensando em projetos orientados a objetos (projetos tradicionais). 

De fato projetos Android são orientado a objetos, no entanto possuem particularidades que ainda não foram experimentadas em projetos tradicionais, principalmente com relação a camada de apresentação, onde ele apresenta maiores distinções com relação a projetos tradicionais. Segundo \cite{Hecht2015} \textit{``Android-specific antipatterns are far more frequent and common than OO antipatterns.''}. Por exemplo, além de código Java, grande parte de um projeto Android é constituído por arquivos XML, que são os recursos da aplicação localizados dentro do diretório \texttt{res}, normalmente responsáveis por apresentar algo ao usuário como uma tela, uma imagem, uma tradução e assim por diante. No início do projeto estes arquivos costumam ser poucos e pequenos. Conforme o projeto evolui, esta quantidade aumenta junto com sua complexidade, trazendo problemas em encontrá-las, reaproveitá-las e entendê-las. Enquanto estes problemas já estão bem resolvidos em projetos tradicionais, ainda não há uma forma sistemática de identificá-los em recursos de projetos Android para que possam ser refatorados. 

Outra particularidade é sobre componentes como \textsc{Activities} que por natureza são classes que possuem muitas responsabilidades \cite{MobileSmells:13}, sempre estão vinculadas a um \textsc{Layout} e normalmente precisam de acesso a classes do modelo da aplicação. Analogamente ao padrão MVC, \textsc{Activities} fazem um pouco o papel de \textsc{View} e \textsc{Controller}. Poderíamos classificá-la com o conhecido \textit{code smell} \textit{God Class} \cite{riel1996object}, no entanto, a proposta de refatoração dada a ele não necessáriamente é a mais apropriada para uma \textsc{Activity}, que é um componente específico da plataforma Android, responsável pela apresentação e interações do usuário com uma tela \cite{AndroidActivities2016}. 

Na prática, desenvolvedores Android percebem estes problemas diariamente há quase uma década. Muitos deles já se utilizam de práticas para solucioná-los, esta afirmação é enfatizada em \cite{ReimannBrylski2013} ao dizer que \textit{``The problem in mobile development is that developers are aware of quality smells only indirectly because their definitions are informal (best-practices, bug tracker issues, forum discussions etc.) and resources where to find them are distributed over the web.''}. Ou seja, não existe hoje um catálogo destas boas e más práticas, tornando difícil a detecção e sugestão de refatorações apropriadas as particularidades da plataforma. 

No período de 2008 a 2015, nas principais conferências de manutenção de software, apenas 5 \textit{papers} foram sobre maus cheiros Android, dentro de um total de 52 \textit{papers} sobre o assunto \cite{Mannan_Dig_Ahmed_Jensen_Abdullah_Almurshed}. Apesar do rápido crescimento da plataforma Android, pesquisas em torno dela não veem sendo realizadas na mesma velocidade e a ausência de um catálogo de maus cheiros Android resulta em (i) uma carência de conhecimento sobre boas e más práticas a ser compatilhado entre praticantes da plataforma, (ii) indisponibilidade de ter uma ferramenta de detecção de maus cheiros de forma a alertar automaticamente os desenvolvedores da existência dos mesmos e (iii) ausência de estudo empírico sobre o ímpacto destas más práticas na manutenabilidade do código de projetos Android. Por este motivos, boas e más práticas que são específicos a uma platadforma, no caso Android, tem emergido como tópicos de pesquisa sobre manutenção de código \cite{MvcSmells:16}.

% A camada de apresentação do Android possui uma estrutura bem específica, combinando código Java com arquivos \texttt{xml} que representam dos mais variados recursos como \textsc{Layout}'s, elementos gráficos, arquivos de internacionalização, dentre outros. Esta combinação torna o Android diferente de projetos tradicionais. E intensifica a necessidade de pesquisas focadas específicas para guiar o desenvolvimento de forma a mitigar a deteorização.

% Para entendermos estas particularidades, precisamos ter em mente a estrutura de um projeto Android. De forma simplificada, projetos Android possuem um diretório chamado \texttt{java} onde ficam as classes java. Um arquivo de configuração chamado \texttt{AndroidManifest.xml} que contém configurações tais como tela incial, permissões que serão solicitadas ao usuário, dentre outros. Por último, um diretório chamado \texttt{res}, abreviação para o termo \textit{resources}, que contém subpastas com nomes pré-determinados pelo Android onde cada subpasta contém arquivos que desempenham papéis específicos na aplicação, por exemplo, a subpasta \textsc{Layout} contém arquivos que representam a parte visual de telas do Android, a subpasta \textsc{Drawable} contém os elementos gráficos e assim por diante. 


\section{Questões de Pesquisa}
% Nesta tese pretendemos identificar, validar e documentar maus cheiros de código Android com relação a camada de apresentação, onde se encontra grandes distinções quando se comparado a projetos tradicionais.
A questão primária desta pesquisa é \textbf{Quais são as boas e más práticas específicas à camada de apresentação em aplicações Android nativas?}. Para responder a esta questão, temos as seguintes questões secundárias:

\begin{itemize}
	% \item \textbf{Q1: Quais são as classes que representam a camada de apresentação no Android?}
	
	% Visto que não há registros de estudos que delimitam quais arquivos e tipos de classes representam a camada de apresentação no Android, o objetivo desta prmeira questão é, através de um questionário, definir, em termos desta pesquisa, quais elementos de um projeto Android representam a camada de apresentação.

	\item \textbf{Q1: Existe maus cheiros específicos para a camada de apresentação do Android?}
	
	% Após delimitar exatamente quais elementos representam a camada de apresentação, pretende-se coletar, novamente através de um questionário, boas e más práticas utilziadas e/ou percebidas por desenvolvedores em cada elemento da camada de apresentação. Por exemplo, certamente aquivos do tipo \textsc{Layout} e \textsc{Activities} são fortes candidatos a serem parte da camada de apresentação do Android. Desta forma, para cada elemento identificado, serão feitas as seguintes perguntas:
	Pretende-se coletar, através de um questionário, boas e más práticas utilziadas e/ou percebidas por desenvolvedores Android em cada elemento da camada de apresentação. Entendemos que os elementos que compoem a camada de apresentação de projetos Android são:
	\begin{itemize}
		\item Classes que extendem \textsc{android.view.View},
		\item Classes que extendem \textsc{android.widget.Adapter},
		\item Classes que extendem \textsc{android.app.Fragment} ou a mesma representada dentro do pacote \textit{Support Library},
		\item Classes que extendem \textsc{android.app.Activity} ou a mesma representada dentro do pacote \textit{Support Library},
		\item Todo \textit{listener}. Apesar de Android \textit{listeners} extenderem a class \textsc{android.view.View}, pretende-se avaliá-la como um elemento separado pois no dia-a-dia do desenvolvimento ela desempenha um papel importânte,
		\item Todo conteúdo do diretório \textsc{res}. Cada tipo de recurso será considerado um elemento separado no questionário. %Listar item a item aqui ou em momento futuro
	\end{itemize}

	Para cada elemento listado acima, pretende-se fazer as seguintes perguntas (``X'' indica o elemento em pauta na questão):
	\begin{itemize}
		\item Você conhece ou utiliza alguma boa prática para lidar com X?
		\item Você considera algo uma má prática para lidar com X?
	\end{itemize}
	
	Para eliminar o risco de não estar considerando algum outro elemento como parte da camada de apresentação, ao final teremos uma pergunta adicional:

	\emph{Na sua opinião, existe algum elemento Android não questionado, que você considera fazer parte da camada de apresentação do aplicativo? Em havendo, poderia listar boas e más práticas para cada elemento sugerido?}

	Estes dados serão analisados, categorizados e extraídos maus cheiros. Estes maus cheiros serão validados com especialistas em desenvolvimento Android.

	\item \textbf{Q2: Desenvolvedores percebem as classes afetadas pelos maus cheiros prpopostos como problemáticas?}
	
	Após a definição de um catálogo de maus cheiros, pretende-se validar se desenvolvedores os percebem de fato como indicativos de trechos de códigos ruins. Para isso pretende-se conduzir um experimento. [Completar aqui]

	Esta questão contempla duas subquestões sobre a relação dos maus cheiros e a tendência a mudanças e introdução de \textit{bugs} no projeto.

	\begin{itemize}
		\item \textbf{Q2.1: Qual a relação entre os maus cheiros propostos e o tendência a mudanças de classes?}
		\item \textbf{Q2.2: Qual a relação entre os maus cheiros propostos e o tendência a introdução de \textit{bugs} nas classes?}
	\end{itemize}
	
\end{itemize}


\section{Trabalhos Relacionados}
% Em outros trabalhos sobre maus cheiros Android, foram identificados maus cheiros relacionados a segurança, consumo inteligente de recursos ou que de alguma maneira influênciavam a experiência ou expectativa do usuário.

[RELACIONADOS] Atualmente já existe alguns maus cheiros especificos para Android catalogados. Num excelente trabalho desempenhado por FULANO, ele cataloga 30 maus cheiros com relação a utilização de recursos e experiência do usuário \cite{Hecht2015}, o que se difere da nossa pesquisa que busca identificar maus cheiros em termos de qualidade, legibilidade e manutenabilidade de código.

Diversas pesquisas em torno de maus cheiros de código veem sendo realizadas ao longo dos últimos anos. Já existem inclusive diversos maus cheiros mapeados, porém poucos deles são específicos da plataforma Android \cite{Mannan_Dig_Ahmed_Jensen_Abdullah_Almurshed}. Segundo \cite{Hecht2015} estudos sobre maus cheiros de código sobre aplicações Android ainda estão em sua infância, porém ainda assim são muito relevantes inclusive notando-se que é mais comum identificar em aplicativos Android maus cheiros mapeados exclusivamente para esta plataforma do que os maus cheiros tradicionais \cite{DomainMatters, Hecht2015}. 

[VERLOOP] O trabalho de Verloop por exemplo, apesar das relevantes contribuições feitas, a conclusão sobre a incidencia de tais code smells em projetos Android acaba por não ser muito conclusiva, visto que dos 6 code smells analisados (Large Class, Long Method, Long Parameter List, Type Checking, Feature Envy e Dead Code) apenas um deles, Long Method, se apresentar com destaque em projetos Android, os demais apresentam uma diferença mínima em projetos Android vs projetos tradicionais, e acabam por não ser conclusivos quanto a maior relevância deles em mobile ou não, apesar que Verloop conclui que Type Checking também é 2 x mais provável em mobile applications. Verloop conclui com algumas recomendações de refatoração de forma a mitigar a presença do code smell Long Method, conforme mencionado, de fato apresentado com maior relevância em projetos Android, estas recomendações são o uso do ViewHolder pattern em Adaoters, ele sugere um ActivityViewHolder para de forma a extrair código do método onCreate e deixá-lo menor, sugere o uso do atributo onClick em XML de layout e menu, sobre esta recomendação em específico, acredito que será entendida como um anti-pattern, visto que acopla o comportamento a um layout específico além do que hoje já é possível o uso de lambdas também no desenvolvimento android, encurtando muito portanto o tamanha das antigas classes anônimas e o uso de resource ids ao invés dos resources values, onde o código fica mais verboso, logo, mais complicado de ler, ele recomenda sempre que possível, usar o resource id ao invés do resource value. Apesar disso, sabemos que código legível resulta em tempo de desenvolvimento menor, pois códigos complexos dificultam o desenvolvimento de software. Das ferramentas de análise de código analisadas por Verloop, a única que suporta XML é a Lint, desenvolvida pela Google para Android. [DIFERENÇA] Esta tese se difere dele pois pretende-se identificar, validar e catalogar, com base na experiência de desenvolvedores, quais boas e más práticas, ao longo da última década, eles vem praticando ou evitando, respectivamente em projetos Android. Ou seja, não pretende-se a partir de um catálogo já estabelecido de code smells, identificar a incidência em projetos Android pois, apesar de em parte de um projeto Android, o que é puramente utilizado OO, estes code smells poderem ser aplicados, há outra parte em projetos Android, a camada de apresentação, onde não existe estrutura igual no desenvolvimento de software, tornando-a única e necessitada de estudos próprios, de code smells próprios, para guiar o desenvolvimento de código de qualidade, legível e com alto grau de manutenabilidade, assim como identificou-se no passado esta necessidade e valor em projetos OO, identifica-se no presente esta necessidade e valor em projetos Android. 

[30 QUALITY SMELLS] Outro trabalho muito relevante realizado neste tema é A [Too-Supported Qual...]  que, baseado na documentação do Android, documenta 30 quality smells, no texto quality smells são definidos como ``A quality smell is a certain structure in a model, indicating that it negatively influences specific quality requirements, which can be resolved by particular model refactorings''. Estes requisitos de qualidade são centrados no usuários (estabilidade, tempo de início, conformidade com usuário, experiência do usuário e acessibilidade) , eficiância no uso de recursos de hardware (eficiência geral, no uso de energia e meméria) e segurança. [DIFERENÇA] Esta tese se difere dele pois pretendemos encontra code smells em termos de qualidade de código, ou seja, que influênciem na legibilidade e manutenabilidade do código do projeto em desenvolvimento.


\section{Contribuições}
% Diferentemente deles, nossa proposta é catalogar maus cheiros Android que influênciem a qualidade do código. Com isso os desenvolvedores terão mais uma ferramenta aliada para a produção de código de qualidade.

[CONTRIBUIÇÕES] Nossa pesquisa busca identificar, através de questionários aplicados na comunidade de desenvolvimento Android, boas e más práticas para o desenvolvimento da camada de apresentação de projetos Android. Os dados obtidos com o questionário serão categorizados e extraídos maus cheiros de código. De forma a validar que os maus cheiros extraídos fazem sentido, iremos primeiramente validá-los com especialistas Android e depois realizar um experimento com desenvolvedores Android de forma a captar a percepção deles com relação aos maus cheiros definidos.


\section{Organização da Tese}