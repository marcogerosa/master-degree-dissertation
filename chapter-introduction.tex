% -*- root: dissertacao.tex -*-
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setlength{\parindent}{20pt}
\setlength{\textheight}{22cm}
\setlength{\parskip}{0.2cm}
\linespread{1.2} % Para aumentar o espaçamento entre as linhas
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Identificar o contexto e a motivação para o trabalho, especificar o problema, discutir trabalhos relacionados (principalmente as suas limitações), definir as contribuições, enfatizar os resultados principais e a organização do texto.

\chapter{Introdução}

No próximo ano o Android completará uma década desde seu primeiro lançamento em 2007 e não há dúvidas sobre o seu sucesso \cite{AppAnnie:16, PercentSmartphoneSales:09-16,SmartphoneSales:09-16}. Atualmente há disponível mais de 2 milhões de aplicativos na Google Play Store, loja oficial de aplicativos Android \cite{AppInPlayStore:09-16}. Mais de 83,5\% dos \textit{devices} no mundo usam o sistema operacional móvel Android (plataforma Android), e este percentual vem crescendo ano após ano \cite{GrowthForecastIDC:16, MobileMarketShares:16}. Hoje é possível encontrá-lo também em outros dispositivos como \textit{smart TVs}, \textit{smartphones}, carros, dentre outros \cite{AndroidAuto:16, AndroidSmart:14}. Estes dados somado a experiência do autor são alguns dos motivos desta dissertação focar na plataforma Android.

Duas tarefas que desenvolvedores de software constantemente fazem é escrever código fácil de ser mantido e evoluído e detecar trechos de código problemáticos. Para a primeira, desenvolvedores comumente buscam se apoiar em boas práticas e \textit{design patterns} já estabelecidos \cite{alur2003core, rozanski2012software, gamma1994design}. Para a segunda, é comum se utilizar de estratégias de detecção de maus cheiros de código (\textit{code smells}), estes apontam trechos de códigos que podem se beneficiar de refatoração, ou seja, melhorar o código sem alterar o comportamento \cite{RefactoringFowler1999}. Apesar de já existir um catálogo extenso de \textit{code smells}, eles não levam em consideração a natureza do projeto e suas particularidades \cite{FinavaroAniche2016}. 

Projetos Android possuem particularidades que ainda não foram experimentadas em projetos orientados a objetos, principalmente com relação a camada de apresentação, onde ele apresenta suas maiores distinções. Em uma análise feita por \cite{Hecht2015}, com relação a projetos Android, ele diz que ``\textit{antipatterns} específicos ao Android são mais comuns e ocorrem mais frequentemente do que \textit{antippaterns} OO''. Por exemplo, além de código Java, grande parte de um projeto Android é constituído por arquivos \texttt{XML}. Estes são os recursos da aplicação e ficam localizados no diretório \texttt{res} do projeto. São responsáveis por apresentar algo ao usuário como uma tela, uma imagem, uma tradução e assim por diante. No início do projeto estes arquivos costumam ser poucos e pequenos. Conforme o projeto evolui, a quantidade e complexidade dos recursos tende a aumentar, trazendo problemas em encontrá-las, reaproveitá-las e entendê-las. Enquanto estes problemas já estão bem resolvidos em projetos orientados a objetos, ainda não há uma forma sistemática de identificá-los em recursos de projetos Android para que possam ser refatorados. 

Outra particularidade é sobre componentes como \textsc{Activities} que por natureza são classes que possuem muitas responsabilidades \cite{MobileSmells:13}, sempre estão vinculadas a um \textsc{Layout} e normalmente precisam de acesso a classes do modelo da aplicação. Analogamente ao padrão MVC, \textsc{Activities} fazem os papéis de \textsc{View} e \textsc{Controller} simultâneamente. Isto posto, é razoável considerar que o \textit{code smell} \textit{God Class} \cite{riel1996object} é aplicável neste caso, no entanto, conforme bem pontuado por \cite{FinavaroAniche2016} ``\emph{enquanto [\textit{God Class}] se encaixa bem em qualquer sistema orientado a objetos, ele não leva em consideração as particularidades arquiteturais da aplicação ou o papel desempenhado por uma determinada classe}.''. \textsc{Activities} são componente específico da plataforma Android, responsáveis pela apresentação e interações do usuário com a tela \cite{AndroidActivities2016}. 

Na prática, desenvolvedores Android percebem estes problemas diariamente há quase uma década. Muitos deles já se utilizam de práticas para solucioná-los, esta afirmação é enfatizada em \cite{ReimannBrylski2013} ao dizer que \textit{``The problem in mobile development is that developers are aware of quality smells only indirectly because their definitions are informal (best-practices, bug tracker issues, forum discussions etc.) and resources where to find them are distributed over the web.''}. Ou seja, não existe hoje um catálogo destas boas e más práticas, tornando difícil a detecção e sugestão de refatorações apropriadas as particularidades da plataforma. 

Nas principais conferências de manutenção de software, dentre 2008 a 2015, apenas 5 \textit{papers} foram sobre maus cheiros Android, dentro de um total de 52 \textit{papers} sobre o assunto \cite{Mannan_Dig_Ahmed_Jensen_Abdullah_Almurshed}. Apesar do rápido crescimento da plataforma Android, pesquisas em torno dela não veem sendo realizadas na mesma proporção e a ausência de um catálogo de maus cheiros Android resulta em (i) uma carência de conhecimento sobre boas e más práticas a ser compatilhado entre praticantes da plataforma, (ii) indisponibilidade de ter uma ferramenta de detecção de maus cheiros de forma a alertar automaticamente os desenvolvedores da existência dos mesmos e (iii) ausência de estudo empírico sobre o ímpacto destas más práticas na manutenabilidade do código de projetos Android. Por este motivos, boas e más práticas que são específicos a uma plataforma, no caso Android, tem emergido como tópicos de pesquisa sobre manutenção de código \cite{MvcSmells:16}.

% A camada de apresentação do Android possui uma estrutura bem específica, combinando código Java com arquivos \texttt{xml} que representam dos mais variados recursos como \textsc{Layout}'s, elementos gráficos, arquivos de internacionalização, dentre outros. Esta combinação torna o Android diferente de projetos tradicionais. E intensifica a necessidade de pesquisas focadas específicas para guiar o desenvolvimento de forma a mitigar a deteorização.

% Para entendermos estas particularidades, precisamos ter em mente a estrutura de um projeto Android. De forma simplificada, projetos Android possuem um diretório chamado \texttt{java} onde ficam as classes java. Um arquivo de configuração chamado \texttt{AndroidManifest.xml} que contém configurações tais como tela incial, permissões que serão solicitadas ao usuário, dentre outros. Por último, um diretório chamado \texttt{res}, abreviação para o termo \textit{resources}, que contém subpastas com nomes pré-determinados pelo Android onde cada subpasta contém arquivos que desempenham papéis específicos na aplicação, por exemplo, a subpasta \textsc{Layout} contém arquivos que representam a parte visual de telas do Android, a subpasta \textsc{Drawable} contém os elementos gráficos e assim por diante. 


\section{Questões de Pesquisa}
Nesta dissertação pretendemos responder a pergunta: \textbf{Existem maus cheiros que são específicos à camada de apresentação de projetos Android?} Para isso, exploramos as seguintes questões:
	
\textbf{Q1: O que representa a \emph{Camada de Apresentação} em um projeto Android?}

Esta é uma pegunta importante a ser respondida, visto que toda a pesquisa se baseia nela. No entanto, não há uma resposta direta na documentação oficial do Android. Desta forma, partimos por um estudo teórico da documentação oficial para extrair a definição a ser usada nesta dissertação. O estudo teórico e definição são detalhados na seção \ref*{sc:PresentationLayer} do capítulo \ref*{ch:research}.


\textbf{Q2: Existem boas e más práticas com relação a \emph{Camada de Apresentação} de um projeto Android?}

O objetivo desta questão é ter insumos para a definição dos maus cheiros e propostas de como refatorá-los. Para isso elaboramos um questionário para coletar boas e más práticas utilizadas ou percebidas por desenvolvedores Android com relação a camada de apresentação. 

Estes dados serão analisados de forma a resultar numa lista de maus cheiros. Esta listagem será validada com desenvolvedores Android especialistas, dos quais, alguns compõem times que lidam com Android no Google. Pretende-se aplicar o questionário na comunidade de desenvolvedores Android do Brasil e exterior. Estas etapas são detalhadas na seção \ref{sc:CodeSmellsDefinition} do capítulo \ref{ch:research}.

% Para cada papel da camada de apresentação, fizemos as seguintes questões (``X'' representa o papel em questão):

% \begin{itemize}
% 	\item Você conhece ou utiliza alguma boa prática para lidar com X?
% 	\item Você considera algo uma má prática ao lidar com X?
% \end{itemize}

% Por exemplo, \textsc{Activities} representam um papel na camanda de apresentação, as perguntas acima ficariam da seguinte forma:

% \begin{itemize}
% 	\item Você conhece ou utiliza alguma boa prática para lidar com \textsc{Activities}?
% 	\item Você considera algo uma má prática ao lidar com \textsc{Activities}?
% \end{itemize}

% Por fim, para coletar qualquer outra informação relevante que o respondente queira compartilhar, temos a seguinte pergunta:
% \begin{itemize}
% 	\item Gostaria de compartilhar mais alguma informação, comentário ou sugestão?
% \end{itemize}


\textbf{Q3: Desenvolvedores Android percebem as classes afetadas pelos maus cheiros propostos como problemáticas?}

Com esta questão pretende-se validar a relevância e assertividade dos maus cheiros catalogados. Para isso será conduzido um experimento com desenvolvedores Android de forma a avaliar se eles percebem os códigos afetados pelos maus cheiros como indicativos de trechos problemáticos. Este processo é detalhado na seção \ref{sc:DevPerceptions} do capítulo \ref{ch:research}.

% Estudos prévios mostram que ``maus cheiros tradicionais'' (e.g., Blob Classes) podem impactar na tendência a mudanças de e \textit{bugs} em classes do projeto \cite{FinavaroAniche2016}. Desta forma, será analisado o impacto dos maus cheiros propostos na tendência a mudanças e \textit{bugs} nos elementos da camada de apresentanção. Desta forma, serão respondidas as seguintes perguntas:

% \begin{itemize}
% 	\item \textbf{Q2.1: Qual a relação entre os maus cheiros propostos e a tendência a mudanças do código?}
% 	\item \textbf{Q2.2: Qual a relação entre os maus cheiros propostos e a tendência a \textit{bugs} no código?}
% \end{itemize}

\section{Trabalhos Relacionados}
% Em outros trabalhos sobre maus cheiros Android, foram identificados maus cheiros relacionados a segurança, consumo inteligente de recursos ou que de alguma maneira influênciavam a experiência ou expectativa do usuário.
Diversas pesquisas em torno de maus cheiros de código veem sendo realizadas ao longo dos últimos anos. Já existem inclusive diversos maus cheiros mapeados, porém poucos deles são específicos da plataforma Android \cite{Mannan_Dig_Ahmed_Jensen_Abdullah_Almurshed}. Segundo \cite{Hecht2015} estudos sobre maus cheiros de código sobre aplicações Android ainda estão em sua infância. Outro ponto que reafirma esta questão são os trabalhos \cite{DomainMatters} e \cite{Hecht2015} concluem que é mais comum em projetos Android maus cheiros específicos do que os tradicionais maus cheiros orientados a objetos. 

\subsection*{\textit{Code Smells in the Mobile Applications Domain}}

O trabalho \cite{MobileSmells:13} avalia a presença de \textit{code smells} definidos por \cite{Refactoring:99} e \cite{Mantyla2013} em projetos Android. Apesar das relevantes contribuições feitas, a conclusão sobre a incidência de tais \textit{code smells}, não é plenamente conclusiva, visto que dos 6 \textit{code smells} analisados (\textit{Large Class}, \textit{Long Method}, \textit{Long Parameter List}, \textit{Type Checking}, \textit{Feature Envy} e \textit{Dead Code}) apenas dois deles, \textit{Long Method} e \textit{Type Checking}, se apresentam com maior destaque (duas vezes mais provável) em projetos Android. Os demais apresentam uma diferença mínima em classes Android quando se comparados a classes não específicas do Android. Por fim, acaba por não ser conclusivo quanto a maior relevância deles em Android ou não. 

\cite{MobileSmells:13} conclui com algumas recomendações de refatoração de forma a mitigar a presença do \textit{code smell} \textit{Long Method}. Estas recomendações são o uso do atualmente já reconhecido padrão \textit{ViewHolder} em classes do tipo \texttt{Adapters}. Ele também sugere um \textit{ActivityViewHolder} de forma a extrair código do método \texttt{onCreate} e deixá-lo menor. Sugere também o uso do atributo \texttt{onClick} em XMLs de \textsc{layout} e \textsc{menu}. 

% Sobre esta última recomendação, acredito que será entendida como um anti-pattern, visto que acopla o comportamento a um layout específico além do que hoje já é possível o uso de lambdas também no desenvolvimento android, encurtando muito portanto o tamanha das antigas classes anônimas e o uso de resource ids ao invés dos resources values, onde o código fica mais verboso, logo, mais complicado de ler, ele recomenda sempre que possível, usar o resource id ao invés do resource value. Apesar disso, sabemos que código legível resulta em tempo de desenvolvimento menor, pois códigos complexos dificultam o desenvolvimento de software. Das ferramentas de análise de código analisadas por Verloop, a única que suporta XML é a Lint, desenvolvida pela Google para Android. [DIFERENÇA] 

Esta dissertação se difere do trabalho \cite{MobileSmells:13} pois pretende-se identificar, validar e catalogar, com base na experiência de desenvolvedores, quais boas e más práticas, ao longo da última década, eles vem praticando ou evitando, respectivamente em projetos Android. Ou seja, não pretende-se a partir de um catálogo já estabelecido de \textit{code smells} e sim catalogar \textit{code smells} específicos da camada de apresentação Android.

\subsection*{\textit{A Tool-Supported Quality Smell Catalogue For Android Developers}}

Outro trabalho muito relevante realizado neste tema é o \cite{ReimannBrylski2013} que, baseado na documentação do Android, documenta 30 \textit{quality smells} específicos Android. No texto \textit{quality smells} são definidos como \textit{``A quality smell is a certain structure in a model, indicating that it negatively influences specific quality requirements, which can be resolved by particular model refactorings''}. Estes requisitos de qualidade são centrados no usuários (estabilidade, tempo de início, conformidade com usuário, experiência do usuário e acessibilidade), consumo inteligente de recursos (eficiência geral, no uso de energia e meméria) e segurança.

Esta dissertação se difere do trabalho \cite{ReimannBrylski2013} pois pretende-se encontrar \textit{code smells} em termos de qualidade de código, ou seja, que influênciem na legibilidade e manutenabilidade do código do projeto.


\section{Contribuições}
% Diferentemente deles, nossa proposta é catalogar maus cheiros Android que influênciem a qualidade do código. Com isso os desenvolvedores terão mais uma ferramenta aliada para a produção de código de qualidade.
Ao final desta pesquisa, pretende-se contribuir com um catálogo validade de maus cheiros na camada de apresentação de aplicativos Android. Pretende-se também incrementar a ferramenta de detecção automática de maus cheiros Páprika com os \textit{code smells} validados, de forma a desenvolvedores conseguirem de forma rápida identificar pontos específicos de projetos Android, a refatorar. Garantindo um código de qualidade, fácil de ser mantido e evoluído.


\section{Organização da Tese}

Esta dissertação está organizada da seguinte forma:

\begin{itemize}
	\item \textbf{Capítulo 1} Introdução
	
	Neste capítulo é introduzido o contexto atual do desenvolvimento de aplicativos Android. Apresenta-se quais são as motivações e o problema a ser resolvido. É dado também uma breve introdução sobre como pretende-se resolvê-lo.

	\item \textbf{Capítulo 2} Fundamentação Teórica
	
	Neste capítulo é passado ao leitor informações básicas relevantes para o entedimento do trabalho. Os assuntos aprofundados aqui são: Qualidade de Código, \textit{Code Smells} e Android.

	\item \textbf{Capítulo 3} Pesquisa

	Neste capítulo são apresentados detalhes de toda as etapas da pesquisa. Quais tipos de coleta de dados serão usados. Quais os critérios de escolha dos respondentes e porquê. Como foram realizadas as análises dos dados e quais resultados foram obtidos.

	\item \textbf{Capítulo 4} Catálogo de \textit{Code Smells}

	Neste capítulo, serão catalogados os \textit{code smells} validados.

	\item \textbf{Capítulo 5} Conclusão

	Neste capítulo são apresentadas as conclusões do trabalho bem como as suas limitações e sugestões de trabalhos futuros.
\end{itemize}